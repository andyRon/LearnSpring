SpringBoot
---------------

[SpringBootæœ€æ–°æ•™ç¨‹IDEAç‰ˆé€šä¿—æ˜“æ‡‚](https://www.bilibili.com/video/BV1PE411i7CV)

## å›é¡¾



Javase: OOP

Mysql: æŒä¹…åŒ–

html+css+js+jQuery+æ¡†æ¶ï¼šè§†å›¾

javawebï¼šç‹¬ç«‹å¼€å‘MVCä¸‰å±‚æ¶æ„çš„ç½‘ç«™ï¼ŒåŸå§‹

ssmï¼šç®€åŒ–äº†å¼€å‘æµç¨‹ï¼Œä½†é…ç½®ä¹Ÿå¼€å§‹è¾ƒä¸ºå¤æ‚

ä¸Šé¢ğŸ‘†çš„éƒ½æ˜¯æ‰“waråŒ…åœ¨Tomcatä¸­è¿è¡Œ

springå†ç®€åŒ–ï¼šSpringBootï¼ŒjaråŒ…ï¼Œå†…åµŒTomcatï¼Œå¾®æœåŠ¡æ¶æ„

æœåŠ¡è¶Šæ¥è¶Šå¤šï¼šspringcloud



springbootï¼š

æ˜¯ä»€ä¹ˆ

é…ç½®å¦‚ä½•ç¼–å†™yaml

è‡ªåŠ¨è£…é…åŸç†ï¼ˆæ ¸å¿ƒï¼‰

ç»§æ‰¿webå¼€å‘ï¼šä¸šåŠ¡çš„æ ¸å¿ƒ

é›†æˆæ•°æ®åº“Druid

åˆ†å¸ƒå¼å¼€å‘ï¼šDubboï¼ˆRPCï¼‰+zookeeper

swggerï¼šæ¥å£æ–‡æ¡£

ä»»åŠ¡è°ƒåº¦

SpringSecuityï¼ŒShiroï¼ˆç›¸å½“äºæ‰©å±•æ‹¦æˆªå™¨ï¼‰



SpringCloudï¼š

å¾®æœåŠ¡

springcloudå…¥é—¨

RESTful

Eurekaï¼ˆç±»ä¼¼zookeeperï¼‰

Ribbonï¼ŒFeign  ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰

HyStrix

Zuul è·¯ç”±ç½‘å…³

SpringCloud configï¼ˆgitï¼‰



### Springæ˜¯å¦‚ä½•ç®€åŒ–Javaå¼€å‘çš„
ä¸ºäº†é™ä½Javaå¼€å‘çš„å¤æ‚æ€§ï¼ŒSpringé‡‡ç”¨äº†ä»¥ä¸‹4ç§å…³é”®ç­–ç•¥ï¼š 

1. åŸºäºPOJOçš„è½»é‡çº§å’Œæœ€å°ä¾µå…¥æ€§ç¼–ç¨‹ï¼› 
2. é€šè¿‡I0Cï¼Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å’Œé¢å‘æ¥å£å®ç°æ¾è€¦åˆï¼› 
3. åŸºäºåˆ‡é¢ï¼ˆAOPï¼‰å’Œæƒ¯ä¾‹è¿›è¡Œå£°æ˜å¼ç¼–ç¨‹ï¼›
4. é€šè¿‡åˆ‡é¢å’Œæ¨¡ç‰ˆå‡å°‘æ ·å¼ä»£ç ï¼›

### ä»€ä¹ˆæ˜¯Spring Boot
å­¦è¿‡javawebçš„åŒå­¦å°±çŸ¥é“ï¼Œå¼€å‘ä¸€ä¸ªwebåº”ç”¨ï¼Œä»æœ€åˆå¼€å§‹æ¥è§¦Servletç»“åˆTomcatï¼Œè·‘å‡ºä¸€ä¸ªHello Wolrldç¨‹åºï¼Œæ˜¯è¦ç»è¿‡ç‰¹åˆ«å¤šçš„æ­¥éª¤ï¼›åæ¥å°±ç”¨äº†æ¡†æ¶Strutsï¼ˆhttp://xxxx.doï¼‰ï¼Œå†åæ¥æ˜¯SpringMVCï¼Œåˆ°äº†ç°åœ¨çš„SpringBootï¼Œè¿‡ä¸€ä¸¤å¹´åˆä¼šæœ‰å…¶ä»–webæ¡†æ¶å‡ºç°ã€‚ä»€ä¹ˆæ˜¯Spring Bootå‘¢ï¼Œå°±æ˜¯ä¸€ä¸ªjavawebçš„å¼€å‘æ¡†æ¶ï¼Œå’ŒSpringMVCç±»ä¼¼ï¼Œå¯¹æ¯”å…¶ä»–javawebæ¡†æ¶çš„å¥½å¤„ï¼Œå®˜æ–¹è¯´æ˜¯ç®€åŒ–å¼€å‘ï¼Œçº¦å®šå¤§äºé…ç½®ï¼Œyou can"just run"ï¼Œèƒ½è¿…é€Ÿçš„å¼€å‘webåº”ç”¨ï¼Œå‡ è¡Œä»£ç å¼€å‘ä¸€ä¸ªhttpæ¥å£ã€‚



æ–°æœåŠ¡æ¶æ„ï¼šæœåŠ¡ç½‘æ ¼



æ‰€æœ‰çš„æŠ€æœ¯æ¡†æ¶çš„å‘å±•ä¼¼ä¹éƒ½éµå¾ªäº†ä¸€æ¡ä¸»çº¿è§„å¾‹ï¼šä»ä¸€ä¸ªå¤æ‚åº”ç”¨åœºæ™¯è¡ç”Ÿä¸€ç§è§„èŒƒæ¡†æ¶ï¼Œäººä»¬åªéœ€è¦è¿›è¡Œå„ç§é…ç½®è€Œä¸éœ€è¦è‡ªå·±å»å®ç°å®ƒï¼Œè¿™æ—¶å€™å¼ºå¤§çš„é…ç½®åŠŸèƒ½æˆäº†ä¼˜ç‚¹ï¼›å‘å±•åˆ°ä¸€å®šç¨‹åº¦ä¹‹åï¼Œäººä»¬æ ¹æ®å®é™…ç”Ÿäº§åº”ç”¨æƒ…å†µï¼Œé€‰å–å…¶ä¸­å®ç”¨åŠŸèƒ½å’Œè®¾è®¡ç²¾åï¼Œé‡æ„å‡ºä¸€äº›è½»é‡çº§çš„æ¡†æ¶ï¼›ä¹‹åä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œå«Œå¼ƒåŸå…ˆçš„å„ç±»é…ç½®è¿‡äºéº»çƒ¦ï¼Œäºæ˜¯å¼€å§‹æå€¡â€œçº¦å®šå¤§äºé…ç½®â€ï¼Œè¿›è€Œäº§ç”Ÿå‡ºä¸€äº›ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆã€‚

æ˜¯çš„è¿™å°±æ˜¯ Javaä¼ä¸šçº§åº”ç”¨ --> J2EE --> spring --> springboot çš„è¿‡ç¨‹ã€‚

éšç€Springä¸æ–­çš„å‘å±•ï¼Œæ¶‰åŠçš„é¢†åŸŸè¶Šæ¥è¶Šå¤šï¼Œé¡¹ç›®æ•´åˆå¼€å‘éœ€è¦é…åˆå„ç§å„æ ·çš„æ–‡ä»¶ï¼Œæ…¢æ…¢å˜å¾—ä¸é‚£ä¹ˆæ˜“ç”¨ç®€å•ï¼Œè¿èƒŒäº†æœ€åˆçš„ç†å¿µï¼Œç”šè‡³äººç§°é…ç½®åœ°ç‹±ã€‚Spring Bootæ­£æ˜¯åœ¨è¿™æ ·çš„ä¸€ä¸ªèƒŒæ™¯ä¸‹è¢«æŠ½è±¡å‡ºæ¥çš„å¼€å‘æ¡†æ¶ï¼Œç›®çš„ä¸ºäº†è®©å¤§å®¶**æ›´å®¹æ˜“çš„ä½¿ç”¨Springã€æ›´å®¹æ˜“çš„é›†æˆå„ç§å¸¸ç”¨çš„ä¸­é—´ä»¶ã€å¼€æºè½¯ä»¶**ã€‚

Spring BootåŸºäºSpringå¼€å‘ï¼ŒSpirng Bootæœ¬èº«å¹¶ä¸æä¾›Springæ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§ä»¥åŠæ‰©å±•åŠŸèƒ½ï¼Œåªæ˜¯ç”¨äºå¿«é€Ÿã€æ•æ·åœ°å¼€å‘æ–°ä¸€ä»£åŸºäºSpringæ¡†æ¶çš„åº”ç”¨ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¹¶ä¸æ˜¯ç”¨æ¥æ›¿ä»£Springçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å’ŒSpringæ¡†æ¶ç´§å¯†ç»“åˆç”¨äºæå‡Springå¼€å‘è€…ä½“éªŒçš„å·¥å…·ã€‚

Spring Bootä»¥**çº¦å®šå¤§äºé…ç½®**çš„æ ¸å¿ƒæ€æƒ³ï¼Œé»˜è®¤å¸®æˆ‘ä»¬è¿›è¡Œäº†å¾ˆå¤šè®¾ç½®ï¼Œå¤šæ•°Spring Bootåº”ç”¨åªéœ€è¦å¾ˆå°‘çš„Springé…ç½®ã€‚åŒæ—¶å®ƒé›†æˆäº†å¤§é‡å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“é…ç½®ï¼ˆä¾‹å¦‚Redisã€MongoDBã€JPAã€RabbitMQã€Quartzç­‰ç­‰ï¼‰ï¼ŒSpring Bootåº”ç”¨ä¸­è¿™äº›ç¬¬ä¸‰æ–¹åº“å‡ ä¹å¯ä»¥é›¶é…ç½®çš„å¼€ç®±å³ç”¨ã€‚

Spring Bootå‡ºç”Ÿåé—¨ï¼Œä»ä¸€å¼€å§‹å°±ç«™åœ¨ä¸€ä¸ªæ¯”è¾ƒé«˜çš„èµ·ç‚¹ï¼Œåˆç»è¿‡è¿™å‡ å¹´çš„å‘å±•ï¼Œç”Ÿæ€è¶³å¤Ÿå®Œå–„ï¼ŒSpring Bootå·²ç»å½“ä¹‹æ— æ„§æˆä¸ºJavaé¢†åŸŸæœ€çƒ­é—¨çš„æŠ€æœ¯ã€‚
Spring Bootçš„ä¸»è¦ä¼˜ç‚¹ï¼š

- ä¸ºæ‰€æœ‰Springå¼€å‘è€…æ›´å¿«çš„å…¥é—¨
- å¼€ç®±å³ç”¨ï¼Œæä¾›å„ç§é»˜è®¤é…ç½®æ¥ç®€åŒ–é¡¹ç›®é…ç½®
- å†…åµŒå¼å®¹å™¨ç®€åŒ–Webé¡¹ç›®
- æ²¡æœ‰å†—ä½™ä»£ç ç”Ÿæˆå’ŒXMLé…ç½®çš„è¦æ±‚



## å¾®æœåŠ¡

MVC  MVVM  å¾®æœåŠ¡æ¶æ„

ä¸šåŠ¡ï¼šserviceï¼šuserService  ==> æ¨¡å—



### ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ

å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªåº”ç”¨å¿…é¡»æ„å»ºæˆä¸€ç³»åˆ—å°æœåŠ¡çš„ç»„åˆï¼Œå¯ä»¥é€šè¿‡httpçš„æ–¹å¼è¿›è¡Œäº’é€šã€‚è¦è¯´å¾®æœåŠ¡æ¶æ„ï¼Œå…ˆå¾—è¯´è¯´è¿‡å»æˆ‘ä»¬çš„å•ä½“åº”ç”¨æ¶æ„ï¼Œ

![](images/image-20210930074842966.png)

### å•ä½“åº”ç”¨æ¶æ„

æ‰€è°“å•ä½“åº”ç”¨æ¶æ„ï¼ˆall in oneï¼‰æ˜¯æŒ‡ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªåº”ç”¨çš„ä¸­çš„æ‰€æœ‰åº”ç”¨æœåŠ¡éƒ½å°è£…åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ã€‚
æ— è®ºæ˜¯ERPã€CRMæˆ–æ˜¯å…¶ä»–ä»€ä¹ˆç³»ç»Ÿï¼Œä½ éƒ½æŠŠæ•°æ®åº“è®¿é—®ï¼Œwebè®¿é—®ï¼Œç­‰ç­‰å„ä¸ªåŠŸèƒ½æ”¾åˆ°ä¸€ä¸ªwaråŒ…å†…ã€‚

- è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ˜“äºå¼€å‘å’Œæµ‹è¯•ä¹Ÿååˆ†æ–¹ä¾¿éƒ¨ç½²ï¼›å½“éœ€è¦æ‰©å±•æ—¶ï¼Œåªéœ€è¦å°†warå¤åˆ¶å¤šä»½ï¼Œç„¶åæ”¾åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå†åšä¸ªè´Ÿè½½å‡è¡¡å°±å¯ä»¥äº†ã€‚

- å•ä½“åº”ç”¨æ¶æ„çš„ç¼ºç‚¹æ˜¯ï¼Œå“ªæ€•æˆ‘è¦ä¿®æ”¹ä¸€ä¸ªéå¸¸å°çš„åœ°æ–¹ï¼Œæˆ‘éƒ½éœ€è¦åœæ‰æ•´ä¸ªæœåŠ¡ï¼Œé‡æ–°æ‰“åŒ…ã€éƒ¨ç½²è¿™ä¸ªåº”ç”¨waråŒ…ã€‚ç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªå¤§å‹åº”ç”¨ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å§æ‰€æœ‰å†…å®¹éƒ½æ”¾åœ¨ä¸€ä¸ªåº”ç”¨é‡Œé¢ï¼Œæˆ‘ä»¬å¦‚ä½•ç»´æŠ¤ã€å¦‚ä½•åˆ†å·¥åˆä½œéƒ½æ˜¯é—®é¢˜ã€‚

  

### å¾®æœåŠ¡æ¶æ„

all in oneçš„æ¶æ„æ–¹å¼ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰çš„åŠŸèƒ½å•å…ƒæ”¾åœ¨ä¸€ä¸ªåº”ç”¨é‡Œé¢ã€‚ç„¶åæˆ‘ä»¬æŠŠæ•´ä¸ªåº”ç”¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚å¦‚æœè´Ÿè½½èƒ½åŠ›ä¸è¡Œï¼Œæˆ‘ä»¬å°†æ•´ä¸ªåº”ç”¨è¿›è¡Œæ°´å¹³å¤åˆ¶ï¼Œè¿›è¡Œæ‰©å±•ï¼Œç„¶åå†è´Ÿè½½å‡è¡¡ã€‚

æ‰€è°“å¾®æœåŠ¡æ¶æ„ï¼Œå°±æ˜¯æ‰“ç ´ä¹‹å‰all in oneçš„æ¶æ„æ–¹å¼ï¼ŒæŠŠæ¯ä¸ª**åŠŸèƒ½å…ƒç´ **ç‹¬ç«‹å‡ºæ¥ã€‚æŠŠç‹¬ç«‹å‡ºæ¥çš„åŠŸèƒ½å…ƒç´ çš„åŠ¨æ€ç»„åˆï¼Œéœ€è¦çš„åŠŸèƒ½å…ƒç´ æ‰å»æ‹¿æ¥ç»„åˆï¼Œéœ€è¦å¤šä¸€äº›æ—¶å¯ä»¥æ•´åˆå¤šä¸ªåŠŸèƒ½å…ƒç´ ã€‚æ‰€ä»¥**å¾®æœåŠ¡æ¶æ„æ˜¯å¯¹åŠŸèƒ½å…ƒç´ è¿›è¡Œå¤åˆ¶ï¼Œè€Œæ²¡æœ‰å¯¹æ•´ä¸ªåº”ç”¨è¿›è¡Œå¤åˆ¶**ã€‚
è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š

1. èŠ‚çœäº†è°ƒç”¨èµ„æºã€‚
2. æ¯ä¸ªåŠŸèƒ½å…ƒç´ çš„æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå¯æ›¿æ¢çš„ã€å¯ç‹¬ç«‹å‡çº§çš„è½¯ä»¶ä»£ç ã€‚

![](images/image-20210930075406517.png)



### å¦‚ä½•æ„å»ºå¾®æœåŠ¡

ä¸€ä¸ªå¤§å‹ç³»ç»Ÿçš„å¾®æœåŠ¡æ¶æ„ï¼Œå°±åƒä¸€ä¸ªå¤æ‚äº¤ç»‡çš„ç¥ç»ç½‘ç»œï¼Œæ¯ä¸€ä¸ªç¥ç»å…ƒå°±æ˜¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ ï¼Œå®ƒä»¬å„è‡ªå®Œæˆè‡ªå·±çš„åŠŸèƒ½ï¼Œç„¶åé€šè¿‡httpç›¸äº’è¯·æ±‚è°ƒç”¨ã€‚æ¯”å¦‚ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œ<u>æŸ¥ç¼“å­˜ã€è¿æ•°æ®åº“ã€æµè§ˆé¡µé¢ã€ç»“è´¦ã€æ”¯ä»˜</u>ç­‰æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªä¸ªç‹¬ç«‹çš„åŠŸèƒ½æœåŠ¡ï¼Œéƒ½è¢«å¾®åŒ–äº†ï¼Œå®ƒä»¬ä½œä¸ºä¸€ä¸ªä¸ªå¾®æœåŠ¡å…±åŒæ„å»ºäº†ä¸€ä¸ªåºå¤§çš„ç³»ç»Ÿã€‚å¦‚æœä¿®æ”¹å…¶ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåªéœ€è¦æ›´æ–°å‡çº§å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½æœåŠ¡å•å…ƒå³å¯ã€‚
ä½†æ˜¯è¿™ç§åºå¤§çš„ç³»ç»Ÿæ¶æ„ç»™éƒ¨ç½²å’Œè¿ç»´å¸¦æ¥å¾ˆå¤§çš„éš¾åº¦ã€‚äºæ˜¯ï¼ŒSpringä¸ºæˆ‘ä»¬å¸¦æ¥äº†æ„å»ºå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡çš„å…¨å¥—ã€å…¨ç¨‹äº§å“ï¼š

- æ„å»ºä¸€ä¸ªä¸ªåŠŸèƒ½ç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨å•å…ƒï¼Œå¯ä»¥ä½¿ç”¨Spring Bootï¼Œå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿæ„å»ºä¸€ä¸ªåº”ç”¨ï¼› 
- å¤§å‹åˆ†å¸ƒå¼ç½‘ç»œæœåŠ¡çš„è°ƒç”¨ï¼Œè¿™éƒ¨åˆ†ç”±Spring Cloudæ¥å®Œæˆï¼Œå®ç°åˆ†å¸ƒå¼ï¼›
- åœ¨åˆ†å¸ƒå¼ä¸­é—´ï¼Œè¿›è¡Œæµå¼æ•°æ®è®¡ç®—ã€æ‰¹å¤„ç†ï¼Œæœ‰Spring Cloud **Data Flow**](https://dataflow.spring.io/)ï¼›
- Springä¸ºæˆ‘ä»¬æƒ³æ¸…æ¥šäº†æ•´ä¸ªä»å¼€å§‹æ„å»ºåº”ç”¨åˆ°å¤§å‹åˆ†å¸ƒå¼åº”ç”¨å…¨æµç¨‹æ–¹æ¡ˆã€‚

![](../../images/learnspring-033.jpg)



## ç¬¬ä¸€ä¸ªSpringBootç¨‹åº

å®˜æ–¹ï¼šæä¾›äº†ä¸€ä¸ªå¿«é€Ÿç”Ÿæˆçš„ç½‘ç«™ã€‚IDEAé›†æˆäº†è¿™ä¸ªç½‘ç«™ã€‚

æ‰€æœ‰Spring Bootä¾èµ–éƒ½æ˜¯ä½¿ç”¨`spring-boot-starter`å¼€å¤´çš„ã€‚

`spring-boot-starter-web`ç”¨äºå®ç°HTTPæ¥å£ï¼ŒåŒ…å«äº†SpringMVCï¼ŒRESTfulï¼Œä½¿ç”¨Tomcatä½œä¸ºé»˜è®¤åµŒå…¥å¼å®¹å™¨ã€‚

ä½¿ç”¨mavençš„**package**å·¥å…·å¯ä»¥æŠŠé¡¹ç›®æ‰“æˆjarï¼Œç„¶åç‹¬ç«‹è¿è¡Œ

```
java -jar  jaråŒ…
```

ç‰ˆæœ¬å·å¯ä»¥ä¸å†™ï¼Œä¼šç»§æ‰¿çš„çˆ¶ä¾èµ–ã€‚æ‰€æœ‰åŒ…çš„ç‰ˆæœ¬å·éƒ½åœ¨spring-boot-dependenciesé‡Œå¯¹åº”æ–‡ä»¶ï¼š

```
~/.m2/repository/org/springframework/boot/spring-boot-dependencies/2.5.5/spring-boot-dependencies-2.5.5.pom
```

spring boot bannerå®šä¹‰ï¼Œç®€å•çš„æ–¹å¼åªè¦å°†æ–‡ä»¶banner.txtæ”¾å…¥src/main/resourceså³å¯ï¼Œä¹Ÿå¯å›¾ç‰‡ç±»å‹çš„Bannerã€‚é…ç½®æ–¹å¼ä¹Ÿå¯é€šè¿‡è‡ªå®šä¹‰ç±»å®ç°`Banner`æ¥å£çš„æ–¹å¼ã€‚



## è‡ªåŠ¨è£…é…åŸç†

### pom.xml

- `spring-boot-dependencies`ï¼šæ ¸å¿ƒä¾èµ–çš„çˆ¶å·¥ç¨‹
- ä¸Šé¢çš„æ ¸å¿ƒä¾èµ–ï¼Œæœ‰ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬å¼•å…¥ä¾èµ–æ—¶ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬



### å¯åŠ¨å™¨

```xml
<dependency
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter</artifactId>
</dependency>
```

- å¯åŠ¨å™¨å°±æ˜¯SpringBootçš„å¯åŠ¨åœºæ™¯ï¼›æ¯”å¦‚`spring-boot-starter-web`å°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¯¼å…¥webç¯å¢ƒæ‰€æœ‰çš„ä¾èµ–ã€‚
- SpringBootå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯ï¼Œéƒ½å˜æˆäº†ä¸€ä¸ªä¸ªçš„å¯åŠ¨å™¨
- æˆ‘ä»¬è¦ä½¿ç”¨ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±åªéœ€è¦æ‰¾åˆ°å¯¹åº”çš„å¯åŠ¨å™¨å°±å¯ä»¥äº†



### ä¸»ç¨‹åº

```java
@SpringBootApplication
public class Springbooot01HelloworldApplication {

    public static void main(String[] args) {
        SpringApplication.run(Springbooot01HelloworldApplication.class, args);
    }

}
```

#### @SpringBootApplication

```java
@SpringBootApplicationï¼šæ ‡æ³¨è¿™ä¸ªç±»æ˜¯springbootçš„åº”ç”¨ï¼šå¯åŠ¨ç±»ä¸‹çš„æ‰€æœ‰èµ„æºè¢«å¯¼å…¥
	@Configurationï¼šspringé…ç½®ç±»
	@Componentï¼šè¯´æ˜è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªspringç»„ä»¶
	
@EnableAutoConfigurationï¼šè‡ªåŠ¨é…ç½®
	@AutoConfigurationPackageï¼šè‡ªåŠ¨é…ç½®åŒ…
		@Import({Registrar.class})ï¼šè‡ªåŠ¨é…ç½®`åŒ…æ³¨å†Œ`
	@Import({AutoConfigurationImportSelector.class})ï¼šè‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©

```

`AutoConfigurationImportSelector`ç±»ä¸­ï¼š
```java
// è·å–æ‰€æœ‰é…ç½®
List<String> configurations = this.getCandidateConfigurations(annotationMetadata, attributes);

protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
        List<String> configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());
        Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.");
        return configurations;
    }

// loadFactoryNames -> loadSpringFactories
Properties properties = PropertiesLoaderUtils.loadProperties(resource); // åŠ è½½æ‰€æœ‰èµ„æº

```

`META-INF/spring.factories`ï¼šè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæ–‡ä»¶ã€‚å®ƒçš„ä½ç½®åœ¨ï¼š

![](images/image-20210930145824222.png)

**spring.factories**æ–‡ä»¶ä¸­æ‰€éƒ½ä¼šè¢«åŠ è½½ï¼Œä½†æ˜¯å¦ç”Ÿæ•ˆï¼Œé€šè¿‡ä¸‹é¢ä¸€äº›åˆ—çš„æ³¨è§£æ¥åˆ¤æ–­ï¼›

`@ConditionalOnxxx(xxx)`ï¼šæ ¸å¿ƒæ³¨è§£ï¼Œå¦‚æœæ‹¬å·ä¸­çš„æ¡ä»¶éƒ½æ»¡è¶³ï¼Œæ‰ä¼šå¯¼å…¥æ¬¡æ³¨è§£æ³¨è§£çš„ç±»ã€‚ï¼ˆåŒ…åä¸º`org.springframework.boot.autoconfigure.condition`ï¼‰

æ€»ç»“ï¼šSpring Bootæ‰€æœ‰è‡ªåŠ¨é…ç½®éƒ½æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™æ‰«æå¹¶åŠ è½½`spring.factories`æ–‡ä»¶ï¼Œæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½åœ¨è¿™é‡Œé¢ï¼Œä½†ä¸ä¸€å®šç”Ÿæ•ˆï¼Œè¦é€šè¿‡ä¸€ç³»åˆ—`@ConditionalOnxxx(xxx)`æ³¨è§£åˆ¤æ–­ã€‚åªè¦å¯¼å…¥å¯¹åº”çš„startï¼Œå°±æœ‰å¯¹åº”çš„å¯åŠ¨å™¨ï¼Œæœ‰äº†å¯åŠ¨å™¨ï¼Œè‡ªåŠ¨è£…é…å°±ä¼šç”Ÿæ•ˆï¼Œç„¶åé…ç½®æˆåŠŸï¼

- æ•´åˆJavaEEï¼Œè§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®çš„ä¸œè¥¿éƒ½åœ¨`spring-boot-autoconfigure-xxxx.jar`åŒ…ä¸‹ï¼›
- å®ƒä¼šæŠŠæ‰€æœ‰éœ€è¦å¯¼å…¥çš„ç»„ä»¶ï¼Œä»¥ç±»åçš„æ–¹å¼è¿”å›ï¼Œè¿™äº›ç»„ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°å®¹å™¨ï¼›
- å®¹å™¨ä¸­ä¹Ÿä¼šå­˜åœ¨éå¸¸å¤šçš„`xxxAutoConfiguration`ï¼ˆ`@Bean`ï¼‰ï¼Œå°±æ˜¯è¿™äº›ç±»ç»™å®¹å™¨ä¸­å¯¼å…¥äº†è¿™ä¸ªåœºæ™¯éœ€è¦çš„æ‰€æœ‰ç»„ä»¶ï¼›å¹¶è‡ªåŠ¨é…ç½®ï¼Œ@Configurationï¼ŒJavaConfig
- æœ‰äº†è‡ªåŠ¨é…ç½®ç±»ï¼Œå…å»äº†æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™é…ç½®æ–‡ä»¶çš„å·¥ä½œ

| @Conditionalæ‰©å±•æ³¨è§£            | ä½œç”¨ï¼ˆåˆ¤æ–­æ˜¯å¦æ»¡è¶³å½“å‰æŒ‡å®šæ¡ä»¶ï¼‰                 |
| ------------------------------- | ------------------------------------------------ |
| @ConditionalOnJava              | ç³»ç»Ÿçš„javaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚                       |
| @ConditionalOnBean              | å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBean                               |
| @ConditionalOnMissingBean       | å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBean                             |
| @ConditionalOnExpression        | æ»¡è¶³SpELè¡¨è¾¾å¼æŒ‡å®š                               |
| @ConditionalOnClass             | ç³»ç»Ÿä¸­æœ‰æŒ‡å®šçš„ç±»                                 |
| @ConditionalOnMissingClass      | ç³»ç»Ÿä¸­æ²¡æœ‰æŒ‡å®šçš„ç±»                               |
| @ConditionalOnSingleCandidate   | å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å®šçš„Beanï¼Œæˆ–è€…è¿™ä¸ªBeanæ˜¯é¦–é€‰Bean |
| @ConditionalOnProperty          | ç³»ç»Ÿä¸­æŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼                   |
| @ConditionalOnResource          | ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šèµ„æºæ–‡ä»¶                     |
| @ConditionalOnWebApplication    | å½“å‰æ˜¯webç¯å¢ƒ                                    |
| @ConditionalOnNotWebApplication | å½“å‰ä¸æ˜¯webç¯å¢ƒ                                  |
| @ConditionalOnJndi              | JNDIå­˜åœ¨æŒ‡å®šé¡¹                                   |

#### SpringApplication

`SpringApplication.run()`åšäº†å››ä»¶äº‹ï¼š

1. æ¨æ–­åº”ç”¨çš„ç±»å‹æ˜¯æ™®é€šçš„é¡¹ç›®è¿˜æ˜¯Webé¡¹ç›®
2. æŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨åˆå§‹åŒ–å™¨ï¼Œè®¾ç½®åˆ° initializerså±æ€§ä¸­
3. æ‰¾å‡ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºç›‘å¬å™¨ï¼Œè®¾ç½®åˆ° listenerså±æ€§ä¸­
4. æ¨æ–­å¹¶è®¾ç½®mainæ–¹æ³•çš„å®šä¹‰ç±»ï¼Œæ‰¾åˆ°è¿è¡Œçš„ä¸»ç±»

runå¯åŠ¨åä¼šåœ¨springbootç³»ç»Ÿä¸­ç‹¬ç«‹å¼€å¯ä¸€ä¸ªjavaè¿›ç¨‹ã€‚

```java
public ConfigurableApplicationContext run(String... args) {
  StopWatch stopWatch = new StopWatch();
  stopWatch.start();
  DefaultBootstrapContext bootstrapContext = this.createBootstrapContext();
  ConfigurableApplicationContext context = null;
  this.configureHeadlessProperty();
  SpringApplicationRunListeners listeners = this.getRunListeners(args);
  listeners.starting(bootstrapContext, this.mainApplicationClass);

  try {
    ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);
    ConfigurableEnvironment environment = this.prepareEnvironment(listeners, bootstrapContext, applicationArguments);
    this.configureIgnoreBeanInfo(environment);
    Banner printedBanner = this.printBanner(environment);
    context = this.createApplicationContext();
    context.setApplicationStartup(this.applicationStartup);
    this.prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);
    this.refreshContext(context);
    this.afterRefresh(context, applicationArguments);
    stopWatch.stop();
    if (this.logStartupInfo) {
      (new StartupInfoLogger(this.mainApplicationClass)).logStarted(this.getApplicationLog(), stopWatch);
    }

    listeners.started(context);
    this.callRunners(context, applicationArguments);
  } catch (Throwable var10) {
    this.handleRunFailure(context, var10, listeners);
    throw new IllegalStateException(var10);
  }

  try {
    listeners.running(context);
    return context;
  } catch (Throwable var9) {
    this.handleRunFailure(context, var9, (SpringApplicationRunListeners)null);
    throw new IllegalStateException(var9);
  }
}
```

![SpringApplication.run](../../images/SpringApplication.run.png)





## é…ç½®

[å®˜æ–¹æ‰€æœ‰é…ç½®åŠå…¶è¯´æ˜](https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html)

SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œåç§°å›ºå®šä¸ºï¼š

- application.propertiesï¼Œ`key=value`
- application.yamlï¼Œ`key: value`

é…ç½®æ–‡ä»¶çš„ä½œç”¨æ˜¯ä¿®æ”¹springbootè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ã€‚

æ¨èä½¿ç”¨yamlæ ¼å¼ï¼Œ

```yaml
name: andy

# å¯¹è±¡
student:
	name: andy
	age: 3
	
# è¡Œå†…å†™æ³•
student: {name: andy,age: 3}

# æ•°ç»„
pets:
	- cat
	- dog
	- pig
	
pets: [cat,dog,pig]
```



yamlå¯ä»¥ç›´æ¥ç»™å®ä½“ç±»èµ‹å€¼

```java
@ConfigurationProperties(prefix = "person")
public class Person {
  ...
 
```

```yaml
person:
  name: andy
  age: 19
  happy: true
  birth: 2012/12/01
  maps: {k1: v1,k2: v2}
  lists:
    - code
    - music
    - girl
  dog:
    name: æ—ºè´¢
    age: 4
```

`@ConfigurationProperties`çš„ä½œç”¨ï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³é…ç½®è¿›è¡Œç»‘å®šã€‚

> application.propertiesç”±äºç¼–ç çš„é—®é¢˜ï¼Œå®¹æ˜“äº§ç”Ÿä¹±ç ã€‚ 

yamlæ”¯æŒæ¾æ•£è¯­æ³•ï¼ˆé©¼å³°å‘½åå’Œ-è¿æ¥æ˜¯å¯ä»¥ç»‘å®šçš„ï¼‰ã€JSR303æ•°æ®æ ¡éªŒ

### JSR303

@Validated

ğŸ”–p10



é…ç½®æ–‡ä»¶`application.yaml`çš„ä½ç½®å¯ä»¥æ˜¯ï¼ˆä¼˜å…ˆé¡ºåºä»é«˜åˆ°ä½ï¼‰ï¼š

```
file:./config/
file./
classpath:/config/
classpath:/
```

`file`æ˜¯æŒ‡é¡¹ç›®æ ¹ç›®å½•ï¼›`classpath`æŒ‡`src/main/java/`å’Œ`src/main/resources`ç›®å½•ã€‚



### å¤šç¯å¢ƒå¼€å‘

```properties
application.properties
application-test.properties
application-dev.properties
```

åœ¨é»˜è®¤çš„`application.properties`ä¸­é…ç½®é€‰æ‹©å¯ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶

```properties
spring.profiles.active=dev
```

yamlæ›´æ–¹ä¾¿ï¼š

```yaml
server:
	port: 8081
spring:
	profiles:
		active: dev

---
server:
	port: 8082
spring:
	profiles: dev
---
server:
	port: 8083
spring:
	profiles: test
```



## è‡ªåŠ¨è£…é…å†ç†è§£

é…ç½®æ–‡ä»¶ä¸­åˆ°åº•èƒ½é…ç½®ä»€ä¹ˆï¼Ÿ é…ç½®æ–‡ä»¶ä¸è‡ªåŠ¨è£…é…ä¸­çš„spring.factoriesæ˜¯ç›¸å…³çš„

```java
// è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»
@Configuration(
    proxyBeanMethods = false
)
// è‡ªåŠ¨é…ç½®å±æ€§ï¼šServerProperties
@EnableConfigurationProperties({ServerProperties.class})
// springçš„åº•å±‚æ³¨è§£ï¼šæ ¹æ®
@ConditionalOnWebApplication(
    type = Type.SERVLET
)
@ConditionalOnClass({CharacterEncodingFilter.class})
@ConditionalOnProperty(
    prefix = "server.servlet.encoding",
    value = {"enabled"},
    matchIfMissing = true
)
public class HttpEncodingAutoConfiguration {
    private final Encoding properties;

    public HttpEncodingAutoConfiguration(ServerProperties properties) {
        this.properties = properties.getServlet().getEncoding();
    }

 ... 
}
```

`@EnableConfigurationProperties`



```java
@ConfigurationProperties(
    prefix = "server",
    ignoreUnknownFields = true
)
public class ServerProperties {
    private Integer port;
    private InetAddress address;
    @NestedConfigurationProperty
    private final ErrorProperties error = new ErrorProperties();
    private ServerProperties.ForwardHeadersStrategy forwardHeadersStrategy;
    private String serverHeader;
    private DataSize maxHttpHeaderSize = DataSize.ofKilobytes(8L);
    private Shutdown shutdown;
    @NestedConfigurationProperty
    private Ssl ssl;
    @NestedConfigurationProperty
    private final Compression compression;
    @NestedConfigurationProperty
    private final Http2 http2;
    private final ServerProperties.Servlet servlet;
    private final ServerProperties.Tomcat tomcat;
    private final ServerProperties.Jetty jetty;
    private final ServerProperties.Netty netty;
    private final ServerProperties.Undertow undertow;
...
  
}
```

é‚£ä¹ˆserverç›¸å…³çš„é…ç½®å°±å…¨æ˜¯`ServerProperties`ä¸­çš„å±æ€§ã€‚

åœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½é…ç½®çš„ï¼Œéƒ½æœ‰ä¸€ä¸ªè§„å¾‹ï¼Œéƒ½æ˜¯**xxPorperties**ç±»çš„å±æ€§ï¼ˆå±æ€§çš„å€¼å°±æ˜¯é…ç½®çš„é»˜è®¤å€¼ï¼‰ï¼Œè€Œè¿™ä¸ªç±»è¢«**xxxAutoConfiguration**è£…é…ã€‚

**xxPorperties**éƒ½æœ‰ä¸€ä¸ª`@ConfigurationProperties(prefix = "spring.security")`æ³¨è§£ã€‚

è‡ªåŠ¨è£…é…çš„ç²¾é«“ï¼š

1. SpringBootå¯åŠ¨ä¼šè‡ªåŠ¨åŠ è½½å¤§é‡è‡ªåŠ¨è£…é…ç±»ã€‚
2. æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰åœ¨SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»å½“ä¸­ï¼›
3. æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›ï¼ˆåªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶å­˜åœ¨åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ‰‹åŠ¨é…ç½®äº†ï¼‰
4. ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»propertiesç±»ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼å³å¯ï¼›

xxxxAutoConfigurartionï¼šè‡ªåŠ¨é…ç½®ç±»ï¼›ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶
xxxxPropertiesï¼šå°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›



é…ç½®`debug: true`ï¼Œå¯æŸ¥çœ‹ï¼Œé‚£äº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼Œé‚£äº›æ²¡æœ‰ã€‚



## SpringBoot Web å¼€å‘

SpringBootåˆ°åº•å¸®æˆ‘ä»¬é…ç½®äº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½è¿›è¡Œä¿®æ”¹ï¼Ÿèƒ½ä¿®æ”¹é‚£äº›ä¸œè¥¿ï¼Ÿèƒ½ä¸èƒ½å‘¢æ‰©å±•ï¼Ÿ

webå¼€å‘è¦è§£å†³çš„é—®é¢˜ï¼š

- å¯¼å…¥é™æ€èµ„æº...
- é¦–é¡µ
- jspï¼Œæ¨¡æ¿å¼•æ“Thymeleaf
- è£…é…æ‰©å±•SpringMVC
- å¢åˆ æ”¹æŸ¥
- æ‹¦æˆªå™¨
- å›½é™…åŒ–



### é™æ€èµ„æº

`WebMvcAutoConfiguration`

```java
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
  if (!this.resourceProperties.isAddMappings()) {
    logger.debug("Default resource handling disabled");
    return;
  }
  // åŠ è½½é™æ€èµ„æºçš„æ–¹å¼ä¸€ï¼šä»webjarsä¸­åŠ è½½
  addResourceHandler(registry, "/webjars/**", "classpath:/META-INF/resources/webjars/");
  
  // æ–¹å¼äºŒï¼šmvcPropertiesï¼ŒresourceProperties
  addResourceHandler(registry, this.mvcProperties.getStaticPathPattern(), (registration) -> {
    registration.addResourceLocations(this.resourceProperties.getStaticLocations());
    if (this.servletContext != null) {
      ServletContextResource resource = new ServletContextResource(this.servletContext, SERVLET_LOCATION);
      registration.addResourceLocations(resource);
    }
  });
}

private void addResourceHandler(ResourceHandlerRegistry registry, String pattern, String... locations) {
  addResourceHandler(registry, pattern, (registration) -> registration.addResourceLocations(locations));
}

private void addResourceHandler(ResourceHandlerRegistry registry, String pattern,
                                Consumer<ResourceHandlerRegistration> customizer) {
  if (registry.hasMappingForPattern(pattern)) {
    return;
  }
  ResourceHandlerRegistration registration = registry.addResourceHandler(pattern);
  customizer.accept(registration);
  registration.setCachePeriod(getSeconds(this.resourceProperties.getCache().getPeriod()));
  registration.setCacheControl(this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());
  registration.setUseLastModified(this.resourceProperties.getCache().isUseLastModified());
  customizeResourceHandlerRegistration(registration);
}
```



ä»€ä¹ˆæ˜¯webjarsï¼Ÿhttps://www.webjars.org/

ä»¥mavenç­‰æ–¹å¼å¼•å…¥jQueryç­‰å‰ç«¯é™æ€èµ„æºã€‚

```xml
<dependency>
  <groupId>org.webjars</groupId>
  <artifactId>jquery</artifactId>
  <version>3.6.0</version>
</dependency>
```



åœ°å€æ ä¸­çš„`/webjars/**`å°±æ˜ å°„åˆ°åŒ…è·¯å¾„çš„`/META-INF/resources/webjars/`ï¼Œå¦‚ä¸‹

http://localhost:8080/webjars/jquery/3.6.0/jquery.jsã€‚

å¦å¤–ä¸€ç§åŠ è½½é™æ€èµ„æºçš„æ–¹å¼ï¼š

`WebMvcProperties`

```java
private String staticPathPattern = "/**";
```

`WebProperties`

```java
// ä¸‹é¢ä¼˜å…ˆçº§ä»ä¸Šåˆ°ä¸‹ï¼Œè¶Šä½
private static final String[] CLASSPATH_RESOURCE_LOCATIONS = { "classpath:/META-INF/resources/",
				"classpath:/resources/", "classpath:/static/", "classpath:/public/" };
```

> é»˜è®¤`java/`å’Œ`resources`éƒ½å±äºclasspathã€‚

æ€»ç»“ï¼š

1. springbootä¸­é™æ€èµ„æºå¯ä»¥
   - webjarsï¼Œ`localhost:8080/webjars/`
   - publicã€staticã€/**ã€resourcesï¼Œ `localhost:8080/`

2. å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰`spring.mvc.static-path-pattern`ä¼šå¯¼è‡´ä¸Šé¢é»˜è®¤çš„é™æ€èµ„æºç›®å½•å¤±æ•ˆã€‚



### é¦–é¡µ

`WebMvcAutoConfiguration`

```java
private Resource getIndexHtml(Resource location) {
  try {
    Resource resource = location.createRelative("index.html");
    if (resource.exists() && (resource.getURL() != null)) {
      return resource;
    }
  }
  catch (Exception ex) {
  }
  return null;
}
```

é¦–é¡µé»˜è®¤å°±æ˜¯ä»ä¸Šä¸€èŠ‚ä¸­å‡ ä¸ªé™æ€èµ„æºç›®å½•ä¸­å¯»æ‰¾â€index.htmlâ€œã€‚

åœ¨templatesç›®å½•ä¸­çš„æ‰€æœ‰é¡µé¢ï¼Œåªèƒ½é€šè¿‡Controllerè®¿é—®ï¼Œéœ€è¦æ¨¡æ¿å¼•æ“æ”¯æŒã€‚



### æ¨¡æ¿å¼•æ“

å…¶å®jspå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“

Thymeleaf

https://www.thymeleaf.org/

https://github.com/thymeleaf



`spring-boot-starter-thymeleaf`

`ThymeleafProperties`

```java
@ConfigurationProperties(prefix = "spring.thymeleaf")
public class ThymeleafProperties {

	private static final Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;

	public static final String DEFAULT_PREFIX = "classpath:/templates/";

	public static final String DEFAULT_SUFFIX = ".html";
  
  ...
```



### SpringMVCè‡ªåŠ¨é…ç½®åŸç†

[29.1.1 Spring MVC Auto-configuration](https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/boot-features-developing-web-applications.html#boot-features-spring-mvc)



ContentNegotiatingViewResolver



è‡ªå®šä¹‰è§†å›¾è§£æå™¨ï¼š

```java
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {
    // å®ç°äº†ViewResolveræ¥å£çš„ç±»ï¼Œéƒ½å¯ä»¥æŠŠå®ƒçœ‹ä½œè§†å›¾è§£æå™¨

    @Bean
    public ViewResolver myViewResolver() {
        return new MyViewResolver();
    }
    // å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„è§†å›¾è§£æå™¨
    public static class MyViewResolver implements ViewResolver {

        @Override
        public View resolveViewName(String viewName, Locale locale) throws Exception {
            return null;
        }
    }
}
```

æ‰€æœ‰çš„è¯·æ±‚éƒ½è¦ç»è¿‡DispatcherServletçš„doDispatchæ–¹æ³•ï¼Œå¯é€šè¿‡åœ¨è¿™ä¸ªæ–¹æ³•æ‰“æ–­ç‚¹æŸ¥çœ‹è‡ªå®šä¹‰è§†å›¾è§£æå™¨æ˜¯å¦ç”Ÿæ•ˆ 

![](images/image-20211001180338305.png)

è‡ªå®šä¹‰è§†å›¾è§£æå™¨çš„è¿‡ç¨‹ï¼šå®ç°ViewResolveræ¥å£ï¼Œç„¶å@Beanã€‚

ç»“è®ºï¼šå¦‚æœæƒ³diyä¸€äº›å®šåˆ¶åŒ–çš„åŠŸèƒ½ï¼Œåªè¦å†™è¿™ä¸ªç»„ä»¶ï¼Œç„¶åå°†å®ƒäº¤ç»™springbootï¼Œspringbootå°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è£…é…ã€‚

`@EnableWebMvc`æ³¨è§£ä¼šæ˜¯è‡ªå®šä¹‰è§†å›¾è§£æå™¨å¤±æ•ˆï¼Œå› ä¸ºå®ƒå¼•å…¥äº†ç±»`DelegatingWebMvcConfiguration`ï¼Œè€Œå®ƒç»§æ‰¿äº†`WebMvcConfigurationSupport`ï¼ŒæŸ¥çœ‹`WebMvcAutoConfiguration`

çš„æ³¨è§£ï¼š

```java
@Configuration(proxyBeanMethods = false)
@ConditionalOnWebApplication(type = Type.SERVLET)
@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })
@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)
@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)
@AutoConfigureAfter({ DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,
		ValidationAutoConfiguration.class })
public class WebMvcAutoConfiguration {
```

`@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)`è¡¨ç¤ºæ²¡æœ‰`WebMvcConfigurationSupport`æ‰èƒ½ç”Ÿæ•ˆã€‚



åœ¨springbootä¸­ï¼Œæœ‰éå¸¸å¤šçš„`xxxConfiguration`ç±»ï¼Œå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ‰©å±•é…ç½®ï¼Œåªè¦çœ‹è§è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬å°±è¦æ³¨æ„äº†ï¼Œå®ƒå¯èƒ½æ”¹å˜äº†springbootåŸæœ‰çš„é…ç½®æˆ–è€…æ‰©å±•äº†ã€‚



### é¡¹ç›®ï¼šå‘˜å·¥ç®¡ç†ç³»ç»Ÿ



#### é¦–é¡µé…ç½®

æ‰€æœ‰é™æ€èµ„æºéƒ½è¦ä½¿ç”¨Thymeleafæ¥ç®¡ @{}

> é—®é¢˜ï¼šhtmlæ–‡ä»¶ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´å¤ªè¿œæ˜¯ï¼Œæ¨¡æ¿ä¸èƒ½è¢«è¯†åˆ«
>
> ```
> org.thymeleaf.exceptions.TemplateInputException: Error resolving template [404], template might not exist or might not be accessible by any of the configured Template Resolvers
> ```

https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/boot-features-developing-web-applications.html#boot-features-spring-mvc

#### é¡µé¢å›½é™…åŒ–

`MessageSourceAutoConfiguration`

`@{}` åœ°å€

æ³¨æ„ç‚¹ï¼š

1. é…ç½®i18næ–‡ä»¶
2. è‡ªå®šä¹‰ä¸€ä¸ªç»„ä»¶`LocaleResolver`

3. éœ€è¦å°†è‡ªå®šä¹‰ç»„ä»¶é…ç½®åˆ°Springå®¹å™¨ä¸­ï¼Œ`@Bean`
4. `#{}` 

### ç™»å½•



### æ‹¦æˆªå™¨





Thymeleafæ¨¡æ¿å–sessionæ—¶ä½¿ç”¨`[[${seesion.loginUser}]]`è¿™æ ·çš„æ–¹å¼å°±æŠ¥é”™ï¼š

```
2021-10-03 07:48:32.282 ERROR 51839 --- [nio-8081-exec-3] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.thymeleaf.exceptions.TemplateInputException: An error happened during template parsing (template: "class path resource [templates/test.html]")] with root cause
```

åˆé‡åˆ°åŒæ ·çš„é—®é¢˜ï¼š

```
ğŸ”–å¤åˆ¶é™æ€æ–‡ä»¶åˆ°é¡¹ç›®ä¸­ï¼Œå¦‚æœé™æ€æ–‡ä»¶ä¸Šä¸€æ¬¡ä¿®æ”¹æ—¶é—´æ¯”è¾ƒä¹…ï¼Œå°±è®¿é—®ä¸åˆ°ï¼Œéšä¾¿ä¿®æ”¹ä¸€ä¸‹æŠ¥é”™ï¼Œå°±èƒ½è®¿é—®ã€‚
http Last-Modified  è¿‡æœŸæ—¶é—´

```



ğŸ”– p25 ~ p28



å‰ç«¯

- æ¨¡æ¿ï¼šåˆ«äººå†™å¥½çš„é¢ï¼Œæ‹¿æ¥ä¿®æ”¹è‡ªå·±éœ€è¦
- æ¡†æ¶ï¼šç»„ä»¶ï¼Œè‡ªå·±åŠ¨æ‰‹ç»„åˆæ‹¼æ¥ï¼Bootstrapï¼ŒLayuiï¼Œsemantic-ui

å¦‚æœå¿«é€Ÿæ­å»ºwebç½‘ç«™

1. å‰ç«¯æå®šï¼šé¡µé¢é•¿ä»€ä¹ˆæ ·å­ï¼šæ•°æ®
2. è®¾è®¡æ•°æ®åº“ï¼ˆéš¾ç‚¹ï¼ï¼‰
3. å‰ç«¯è®©ä»–èƒ½å¤Ÿè‡ªåŠ¨è¿è¡Œï¼Œç‹¬ç«‹åŒ–å·¥ç¨‹
4. æ•°æ®æ¥å£å¦‚ä½•å¯¹æ¥ï¼šjsonï¼Œå¯¹è±¡
5. å‰åç«¯è”è°ƒæµ‹è¯•



- æœ‰ä¸€ç‚¹è‡ªå·±ç†Ÿæ‚‰çš„åå°æ¨¡æ¿ï¼šå·¥ä½œå¿…è¦[x-admin](http://x.xuebingsi.com/)

- å‰ç«¯ç•Œé¢ï¼šè‡³å°‘èƒ½å¤Ÿé€šè¿‡å‰ç«¯æ¡†æ¶ï¼Œç»„åˆå‡ºæ¥ä¸€ä¸ªç½‘ç«™é¡µé¢

  index

  about

  blog

  post

  user

- è®©è¿™ä¸ªç½‘ç«™ç‹¬ç«‹è¿è¡Œ



## Data

### æ•´åˆJDBCçš„ä½¿ç”¨

å¯¹äºæ•°æ®è®¿é—®å±‚ï¼Œæ— è®ºæ˜¯SQLè¿˜æ˜¯NOSQLï¼ŒSpring Bootåº•å±‚éƒ½é‡‡ç”¨Spring Dataçš„æ–¹å¼è¿›è¡Œç»Ÿä¸€å¤„ç†

mysql5 æœ‰æ—¶æœ‰å¤±å»é—®é¢˜ï¼Œè¦é…ç½®`serverTimeZone=UTC`ã€‚



`DataSourceProperties`

`DataSourceAutoConfiguration`



> `xxxTemplate`ï¼Œéƒ½æ˜¯SpringBootå·²ç»é…ç½®å¥½çš„æ¨¡æ¿beanï¼Œæ‹¿æ¥å³ç”¨



### æ•´åˆDruidæ•°æ®æº



Druidæ˜¯é˜¿é‡Œå·´å·´å¼€æºå¹³å°ä¸Šä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± å®ç°ï¼Œç»“åˆäº†C3P0ã€DBCPã€PROXOOLç­‰DBæ± çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åŠ å…¥äº†æ—¥å¿—ç›‘æ§ã€‚
Druidå¯ä»¥å¾ˆå¥½çš„ç›‘æ§DBæ± è¿æ¥å’ŒSQLçš„æ‰§è¡Œæƒ…å†µï¼Œå¤©ç”Ÿå°±æ˜¯é’ˆå¯¹ç›‘æ§è€Œç”Ÿçš„DBè¿æ¥æ± ã€‚
Spring Boot 2.0ä»¥ä¸Šé»˜è®¤ä½¿ç”¨Hikariæ•°æ®æºï¼Œå¯ä»¥è¯´Hikariä¸Driudéƒ½æ˜¯å½“å‰Java Webä¸Šæœ€ä¼˜ç§€çš„æ•°æ®æºï¼Œæˆ‘ä»¬æ¥é‡ç‚¹ä»‹ç»Spring Bootå¦‚ä½•é›†æˆDruidæ•°æ®æºï¼Œå¦‚ä½•å®ç°æ•°æ®åº“ç›‘æ§ã€‚

`DruidDataSource`



ä¸€äº›ç‰¹æ®Šé…ç½®ï¼š

```yaml
# Spring Booté»˜è®¤æ˜¯ä¸æ€§å…¥è¿™äº›å±æ€§å€¼çš„ï¼Œéœ€è¦è‡ªå·±ç»‘å®š
# druidæ•°æ®æºä¸“æœ‰é…ç½®
initialSize: 5
minIdle: 5
maxActive: 20
maxWait: 60000
timeBetweenEvictionRunsMillis: 60000
minEvictableldleTimeMillis: 300e0e
validationQuery: SELECT 1 FROM DUAL
testwhileIdle: true
testOnBorrow: false
testOnReturn: false
poolPreparedStatements: true
# é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œstatï¼šç›‘æ§ç»Ÿè®¡ã€log4jæ—¥å¿—è®°å½•ã€wallï¼šé˜²å¾¡sqlæ³¨å…¥
# å¦‚æœå…è®¸æ—¶æŠ¥é”™java.lang.classNotFoundExceptionï¼šorg.apache.log4j.Priority
# åˆ™å¯¼å…¥log4jä¾èµ–]ï¼ŒMavenåœ°å€:https://mvnrepository.com/artifact/log4j/log4j
filters: stat,wall,log4j
maxPoolPreparedStatementPerConnectionSize: 20
useGlobalDataSourceStat: true
connectionProperties: druid.stat.mergesql=true;druid.stat.slowSqlMillis=500
```

log4j

### æ•´åˆMyBatis

```xml
<dependency>
  <groupId>org.mybatis.spring.boot</groupId>
  <artifactId>mybatis-spring-boot-starter</artifactI d>
  <version>2.2.0</version>
</dependency>
```

`@Mapper`

ğŸ”– 

æ€»ç»“ï¼š

1. å¯¼å…¥åŒ…
2. é…ç½®æ–‡ä»¶
3. mybatié…ç½®
4. ç¼–å†™sql
5. ä¸šåŠ¡å±‚è°ƒç”¨daoå±‚
6. controllerè°ƒç”¨service



## SpringSecurity

[Spring Security Reference5.5.2](https://docs.spring.io/spring-security/site/docs/current/reference/html5/)

å®‰å…¨åº”è¯¥åœ¨è®¾è®¡ä¹‹åˆè€ƒè™‘

å®‰å…¨æ¡†æ¶ï¼šshiroã€springsecurityï¼Œ

> Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based applications.
>
> Spring Security is a framework that focuses on providing both authentication and authorization to Java applications. Like all Spring projects, the real power of Spring Security is found in how easily it can be extended to meet custom requirements



- åŠŸèƒ½æƒé™
- è®¿é—®æƒé™
- èœå•æƒé™ï¼Œä¸åŒäººä¸åŒèœå•
- ä»¥å‰æ‹¦æˆªå™¨ï¼Œè¿‡æ»¤å™¨ï¼šå¤§é‡çš„åŸç”Ÿä»£ç ~å†—ä½™



 `spring-boot-starter-security`

è®°ä½å‡ ä¸ªç±»ï¼š

- `WebSecurityCorifigurerAdapter`ï¼šè‡ªå®šä¹‰Securityç­–ç•¥.

- `AuthenticationManagerBuilder`ï¼šè‡ªå®šä¹‰è®¤è¯ç­–ç•¥

- `@EnableWebSecurity`ï¼šå¼€å¯WebSecurityæ¨¡å¼ã€‚`@Enablexxx`ç”¨äºå¼€å¯æŸä¸ªåŠŸèƒ½

  

Spring Securityçš„ä¸¤ä¸ªä¸»è¦ç›®æ ‡æ˜¯â€œè®¤è¯â€å’Œâ€œæˆæƒâ€ï¼ˆè®¿é—®æ§åˆ¶ï¼‰ï¼š

â€œè®¤è¯â€ï¼ˆAuthenticationï¼‰
"æˆæƒâ€ï¼ˆAuthorizationï¼‰
è¿™ä¸ªæ¦‚å¿µæ˜¯é€šç”¨çš„ï¼Œè€Œä¸æ˜¯åªåœ¨Spring Securityä¸­å­˜åœ¨ã€‚

> é—®é¢˜ï¼šå¯åŠ¨springboot ï¼Œä¸€ç›´302æŒ‘æˆ˜åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„ç™»å½•é¡µé¢loginã€‚
>
> åŸå› åˆ†æï¼šåœ¨ SpringBoot é¡¹ç›®ä¸­ä½¿ç”¨äº† SpringSecurity ï¼Œé»˜è®¤çš„Spring Securityå°±æ˜¯ç”Ÿæ•ˆäº†çš„ï¼Œæ­¤æ—¶çš„æ¥å£éƒ½æ˜¯è¢«ä¿æŠ¤çš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡éªŒè¯æ‰èƒ½æ­£å¸¸çš„è®¿é—®ã€‚Spring Securityæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·ï¼Œç”¨æˆ·åæ˜¯userï¼Œè€Œå¯†ç åˆ™æ˜¯å¯åŠ¨é¡¹ç›®çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ã€‚
>
> éœ€è¦é…ç½®ã€‚

çœ‹æºç ä¸Šçš„æ³¨é‡Š

å‰ç«¯æ¡†æ¶ï¼š[semantic-ui](https://semantic-ui.com/introduction/getting-started.html)ï¼Œæ¯”bootstrapå¥½çœ‹ä¸€ç‚¹ï¼Œåªè¦å¼•å…¥ä¸€ä¸ªjsæ–‡ä»¶ã€‚



### Spring Securityä¸thymeleafæ•´åˆ

```html
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
```

`xmlns` è¿™ç§å¯¼å…¥æ˜¯ä¸ºäº†ä»£ç æç¤ºã€‚

Spring bootçš„ä¸åŒç‰ˆæœ¬å¯¼è‡´Spring Securityä¸thymeleafæ•´åˆå¤±è´¥

é™çº§ï¼š

```xml
<parent>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-parent</artifactId>
  <version>2.0.9.RELEASE</version>
  <relativePath/> <!-- lookup parent from repository -->
</parent>
```



æ³¨é”€å‡ºç°404ï¼Œæ˜¯å› ä¸ºä¸ºäº†é˜²æ­¢æ”»å‡»ï¼Œè€Œspringsecurityé»˜è®¤å¼€å¯äº†csrfï¼Œå¯ä»¥å…ˆå…³æ‰è°ƒå¼ï¼š

```java
http.csrf().disable();
```



èœå•æ ¹æ®ç”¨æˆ·æƒé™æ˜¾ç¤ºï¼š

```html
<div class="column" sec:authorize="hasRole('VIP1')">
```





## Shiro

### ä»€ä¹ˆæ˜¯Shiro 

- ApacherShiroæ˜¯ä¸€ä¸ªJavaçš„å®‰å…¨ï¼ˆæƒé™ï¼‰æ¡†æ¶ã€‚

- Shiroå¯ä»¥éå¸¸å®¹æ˜“çš„å¼€å‘å‡ºè¶³å¤Ÿå¥½çš„åº”ç”¨ï¼Œå…¶ä¸ä»…å¯ä»¥ç”¨åœ¨JavaSEç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨JavaEEç¯å¢ƒã€‚ 

- Shiroå¯ä»¥å®Œæˆï¼Œè®¤è¯ï¼Œæˆæƒï¼ŒåŠ å¯†ï¼Œä¼šè¯ç®¡ç†ï¼ŒWebé›†æˆï¼Œç¼“å­˜ç­‰ã€‚

- ä¸‹è½½åœ°å€:

  http://shiro.apache.org

  https://github.com/apache/shiro

### æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ

![](images/image-20211005184912213.png)



- Authenticationï¼šèº«ä»½è®¤è¯ã€ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ï¼›
- Authorizationï¼šæˆæƒï¼Œå³æƒé™éªŒè¯ï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼Œå³åˆ¤æ–­ç”¨æˆ·èƒ½å¦è¿›è¡Œä»€ä¹ˆæ“ä½œï¼Œå¦‚ï¼šéªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªè§’è‰²ï¼Œæˆ–è€…ç»†ç²’åº¦çš„éªŒè¯æŸä¸ªç”¨æˆ·å¯¹æŸä¸ªèµ„æºæ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼
- Session Managerï¼šä¼šè¯ç®¡ç†ï¼Œå³ç”¨æˆ·ç™»å½•åå°±æ˜¯ç¬¬ä¸€æ¬¡ä¼šè¯ï¼Œåœ¨æ²¡æœ‰é€€å‡ºä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¼šè¯ä¸­ï¼› ä¼šè¯å¯ä»¥æ˜¯æ™®é€šçš„JavaSEç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ˜¯Webç¯å¢ƒï¼›
- Cryptographyï¼šåŠ å¯†ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œå¦‚å¯†ç åŠ å¯†å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œä¸æ˜¯æ˜æ–‡å­˜å‚¨
- Web Supportï¼šWebæ”¯æŒï¼Œå¯ä»¥éå¸¸å®¹æ˜“çš„é›†æˆåˆ°Webç¯å¢ƒï¼›
- Cachingï¼šç¼“å­˜ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•åï¼Œå…¶ç”¨æˆ·ä¿¡æ¯ï¼Œæ‹¥æœ‰çš„è§’è‰²ã€æƒé™ä¸å¿…æ¯æ¬¡å»æŸ¥ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡
- Concurrencyï¼š Shiroæ”¯æŒå¤šçº¿ç¨‹åº”ç”¨çš„å¹¶å‘éªŒè¯ï¼Œå³ï¼Œå¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œèƒ½æŠŠæƒé™è‡ªåŠ¨çš„ä¼ æ’­è¿‡å»
- Testingï¼šæä¾›æµ‹è¯•æ”¯æŒï¼›
- RunAsï¼šå…è®¸ä¸€ä¸ªç”¨æˆ·å‡è£…ä¸ºå¦ä¸€ä¸ªç”¨æˆ·ï¼ˆå¦‚æœä»–ä»¬å…è®¸ï¼‰çš„èº«ä»½è¿›è¡Œè®¿é—®ï¼›
- RememberMeï¼šè®°ä½æˆ‘ï¼Œè¿™ä¸ªæ˜¯éå¸¸å¸¸è§çš„åŠŸèƒ½ï¼Œå³ä¸€æ¬¡ç™»å½•åï¼Œä¸‹æ¬¡å†æ¥çš„è¯ä¸ç”¨ç™»å½•äº†

### Shiroæ¶æ„ï¼ˆå¤–éƒ¨ï¼‰

ä»å¤–éƒ¨æ¥çœ‹Shiroï¼Œå³ä»åº”ç”¨ç¨‹åºè§’åº¦æ¥è§‚å¯Ÿå¦‚ä½•ä½¿ç”¨shiroå®Œæˆå·¥ä½œï¼š

![](images/image-20211005185814454.png)

- subjectï¼šåº”ç”¨ä»£ç ç›´æ¥äº¤äº’çš„å¯¹è±¡æ˜¯Subjectï¼Œä¹Ÿå°±æ˜¯è¯´Shiroçš„å¯¹å¤–APIæ ¸å¿ƒå°±æ˜¯Subjectï¼ŒSubjectä»£è¡¨äº†å½“å‰çš„ç”¨æˆ·ï¼Œè¿™ä¸ªç”¨æˆ·ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå…·ä½“çš„äººï¼Œä¸å½“å‰åº”ç”¨äº¤äº’çš„ä»»ä½•ä¸œè¥¿éƒ½æ˜¯Subjectï¼Œå¦‚ç½‘ç»œçˆ¬è™«ï¼Œæœºå™¨äººç­‰ï¼Œä¸Subjectçš„æ‰€æœ‰äº¤äº’éƒ½ä¼šå§”æ‰˜ç»™SecurityManagerï¼› Subjectå…¶å®æ˜¯ä¸€ä¸ªé—¨é¢ï¼ŒSecurityManageeræ‰æ˜¯å®é™…çš„æ‰§è¡Œè€…
- SecurityManagerï¼šå®‰å…¨ç®¡ç†å™¨ï¼Œå³æ‰€æœ‰ä¸å®‰å…¨æœ‰å…³çš„æ“ä½œéƒ½ä¼šä¸SercurityManageräº¤äº’ï¼Œå¹¶ä¸”å®ƒç®¡ç†ç€æ‰€æœ‰çš„Subjectï¼Œå¯ä»¥çœ‹å‡ºå®ƒæ˜¯Shiroçš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£ä¸Shiroçš„å…¶ä»–ç»„ä»¶è¿›è¡Œäº¤äº’ï¼Œå®ƒç›¸å½“äºSpringMVCçš„
  DispatcherServletçš„è§’è‰²
- Realmï¼šShiroä»Realmè·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ï¼Œè§’è‰²ï¼Œæƒé™ï¼‰ï¼Œå°±æ˜¯è¯´SecurityManagerè¦éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä»Realmè·å–ç›¸åº”çš„ç”¨æˆ·è¿›è¡Œæ¯”è¾ƒï¼Œæ¥ç¡®å®šç”¨æˆ·çš„èº«ä»½æ˜¯å¦åˆæ³•ï¼›ä¹Ÿéœ€è¦ä»Realmå¾—åˆ°ç”¨æˆ·ç›¸åº”çš„è§’è‰²ã€æƒé™ï¼Œè¿›è¡ŒéªŒè¯ç”¨æˆ·çš„æ“ä½œæ˜¯å¦èƒ½å¤Ÿè¿›è¡Œï¼Œå¯ä»¥æŠŠRealmçœ‹æˆDataSourceï¼›

### Shiroæ¶æ„ï¼ˆå†…éƒ¨ï¼‰

 ![](images/image-20211005190304949.png)

- Subjectï¼šä»»ä½•å¯ä»¥ä¸åº”ç”¨äº¤äº’çš„â€˜ç”¨æˆ·ï¼›
- Security Managerï¼šç›¸å½“äºSpringMVCä¸­çš„DispatcherServletï¼›æ˜¯Shiroçš„å¿ƒè„ï¼Œæ‰€æœ‰å…·ä½“çš„äº¤äº’éƒ½é€šè¿‡ Security Managerè¿›è¡Œæ§åˆ¶ï¼Œå®ƒç®¡ç†è€…æ‰€æœ‰çš„Subjectï¼Œä¸”è´Ÿè´£è¿›è¡Œè®¤è¯ï¼Œæˆæƒï¼Œä¼šè¯ï¼ŒåŠç¼“å­˜çš„ç®¡ç†ã€‚ 
- Authenticatorï¼šè´Ÿè´£Subjectè®¤è¯ï¼Œæ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°ï¼›å¯ä»¥ä½¿ç”¨è®¤è¯ç­–ç•¥ï¼ˆAuthentication Strategyï¼‰ï¼Œå³ä»€ä¹ˆæƒ…å†µä¸‹ç®—ç”¨æˆ·è®¤è¯é€šè¿‡äº†ï¼›
- Authorizerï¼šæˆæƒå™¨ï¼Œå³è®¿é—®æ§åˆ¶å™¨ï¼Œç”¨æ¥å†³å®šä¸»ä½“æ˜¯å¦æœ‰æƒé™è¿›è¡Œç›¸åº”çš„æ“ä½œï¼›å³æ§åˆ¶ç€ç”¨æˆ·èƒ½è®¿é—®åº”ç”¨ä¸­çš„é‚£äº›åŠŸèƒ½ï¼›
- Realmï¼šå¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªçš„realmï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨å®ä½“æ•°æ®æºï¼Œå³ç”¨äºè·å–å®‰å…¨å®ä½“çš„ï¼Œå¯ä»¥ç”¨DBCå®ç°ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…å­˜å®ç°ç­‰ç­‰ï¼Œç”±ç”¨æˆ·æä¾›ï¼›æ‰€ä»¥ä¸€èˆ¬åœ¨åº”ç”¨ä¸­éƒ½éœ€è¦å®ç°è‡ªå·±çš„realm
- SessionManagerï¼šç®¡ç†Sessionç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ï¼Œè€ŒShiroå¹¶ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨Webç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨æ™®é€šçš„JavaSEç¯å¢ƒä¸­
- CacheManagerï¼šç¼“å­˜æ§åˆ¶å™¨ï¼Œæ¥ç®¡ç†å¦‚ç”¨æˆ·ï¼Œè§’è‰²ï¼Œæƒé™ç­‰ç¼“å­˜çš„ï¼›å› ä¸ºè¿™äº›æ•°æ®åŸºæœ¬ä¸Šå¾ˆå°‘æ”¹å˜ï¼Œæ”¾åˆ°ç¼“å­˜ä¸­åå¯ä»¥æé«˜è®¿é—®çš„æ€§èƒ½ï¼›
- Cryptographyï¼šå¯†ç æ¨¡å—ï¼ŒShiroæé«˜äº†ä¸€äº›å¸¸è§çš„åŠ å¯†ç»„ä»¶ç”¨äºå¯†ç åŠ å¯†ï¼Œè§£å¯†ç­‰

githubä¸­çš„**samples/quickstart**

æ­¥éª¤ï¼š

1. å¯¼å…¥ä¾èµ–
2. é…ç½®shiro.ini
3. QuickStart

> pom ä¸­`<scope>`
>
> 1.compileï¼šé»˜è®¤å€¼ ä»–è¡¨ç¤ºè¢«ä¾èµ–é¡¹ç›®éœ€è¦å‚ä¸å½“å‰é¡¹ç›®çš„ç¼–è¯‘ï¼Œè¿˜æœ‰åç»­çš„æµ‹è¯•ï¼Œè¿è¡Œå‘¨æœŸä¹Ÿå‚ä¸å…¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¼ºçš„ä¾èµ–ã€‚æ‰“åŒ…çš„æ—¶å€™é€šå¸¸éœ€è¦åŒ…å«è¿›å»
>
> 2.testï¼šä¾èµ–é¡¹ç›®ä»…ä»…å‚ä¸æµ‹è¯•ç›¸å…³çš„å·¥ä½œï¼ŒåŒ…æ‹¬æµ‹è¯•ä»£ç çš„ç¼–è¯‘å’Œæ‰§è¡Œï¼Œä¸ä¼šè¢«æ‰“åŒ…ï¼Œä¾‹å¦‚ï¼šjunit
>
> 3.runtimeï¼šè¡¨ç¤ºè¢«ä¾èµ–é¡¹ç›®æ— éœ€å‚ä¸é¡¹ç›®çš„ç¼–è¯‘ï¼Œä¸è¿‡åæœŸçš„æµ‹è¯•å’Œè¿è¡Œå‘¨æœŸéœ€è¦å…¶å‚ä¸ã€‚ä¸compileç›¸æ¯”ï¼Œè·³è¿‡äº†ç¼–è¯‘è€Œå·²ã€‚ä¾‹å¦‚JDBCé©±åŠ¨ï¼Œé€‚ç”¨è¿è¡Œå’Œæµ‹è¯•é˜¶æ®µ
>
> 4.providedï¼šæ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä¸ç”¨åŒ…è¿›å»ï¼Œåˆ«çš„è®¾æ–½ä¼šæä¾›ã€‚äº‹å®ä¸Šè¯¥ä¾èµ–ç†è®ºä¸Šå¯ä»¥å‚ä¸ç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œè¿è¡Œç­‰å‘¨æœŸã€‚ç›¸å½“äºcompileï¼Œä½†æ˜¯æ‰“åŒ…é˜¶æ®µåšäº†excludeæ“ä½œ
>
> 5.systemï¼šä»å‚ä¸åº¦æ¥è¯´ï¼Œå’Œprovidedç›¸åŒï¼Œä¸è¿‡è¢«ä¾èµ–é¡¹ä¸ä¼šä»mavenä»“åº“ä¸‹è½½ï¼Œè€Œæ˜¯ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ‹¿ã€‚éœ€è¦æ·»åŠ systemPathçš„å±æ€§æ¥å®šä¹‰è·¯å¾„

```java
Subject currentUser = SecurityUtils.getSubject();
Session session = currentUser.getSession();
currentUser.isAuthenticated()
currentUser.getPrincipal()
currentUser.hasRole("schwartz")
currentUser.isPermitted("lightsaber:wield")
currentUser.logout();
```

###  shiroé›†æˆspringboot

>Subject ç”¨æˆ·
>
>SecurityManager ç®¡ç†æ‰€æœ‰ç”¨æˆ·
>
>Realm è¿æ¥æ•°æ®

```xml
<dependency>
  <groupId>org.apache.shiro</groupId>
  <artifactId>shiro-spring</artifactId>
  <version>1.4.1</version>
</dependency>
```



ç™»å½•æ‹¦æˆª 



#### shiroé›†æˆMyBatis



> MD5ç›å€¼
>
> ç®€å•è¯´å°±æ˜¯ä¸ºäº†ä½¿ç›¸åŒçš„å¯†ç æ‹¥æœ‰ä¸åŒçš„hashå€¼çš„ä¸€ç§æ‰‹æ®µ å°±æ˜¯ç›åŒ–ï¼Œç›å€¼å°±æ˜¯åœ¨å¯†ç hashè¿‡ç¨‹ä¸­æ·»åŠ çš„é¢å¤–çš„éšæœºå€¼ã€‚



```java
CredentialsMatcher
SimpleCredentialsMatcher 
Md5CredentialsMatcher
```

#### æˆæƒ

ğŸ”–p44 p45

## åˆ†æé¡¹ç›®

springbooté¡¹ç›®ç›´æ¥ä¿®æ”¹æ•°æ®åº“è¿æ¥

https://github.com/WinterChenS/my-site

éƒ¨ç½²æ–¹å¼ï¼š

- dockerå®¹å™¨éƒ¨ç½²
- æ™®é€šjaråŒ…éƒ¨ç½²

swagger

## Swagger

å­¦ä¹ ç›®æ ‡

- äº†è§£Swaggerçš„ä½œç”¨å’Œæ¦‚å¿µ
- å·©å›ºå‰åç«¯åˆ†ç¦»
- åœ¨SpringBootä¸­é›†æˆSwagger

### ç®€ä»‹

å‰åç«¯åˆ†ç¦»

Vue + SpringBoot

åç«¯æ—¶ä»£ï¼šå‰ç«¯åªç”¨ç®¡ç†é™æ€é¡µé¢ï¼›html==>åç«¯ï¼Œæ¨¡æ¿å¼•æ“JSP==> åç«¯æ˜¯ä¸»åŠ›



å‰åç›¾åˆ†ç¦»æ—¶ä»£ï¼š

- åç«¯ï¼šåç«¯æ§åˆ¶å±‚ï¼ŒæœåŠ¡å±‚ï¼Œæ•°æ®è®¿é—®å±‚ã€åç«¯å›¢é˜Ÿã€‘
- å‰ç«¯ï¼šå‰ç«¯æ§åˆ¶å±‚ï¼Œè§†å›¾å±‚ã€å‰ç«¯å›¢é˜Ÿã€‘
  - ä¼ªé€ åç«¯æ•°æ®ï¼Œjsonã€‚å·²ç»å­˜åœ¨äº†ï¼Œä¸éœ€è¦åç«¯ï¼Œå‰ç«¯å·¥ç¨‹ä¾æ—§èƒ½å¤Ÿè·‘èµ·æ¥
- å‰åç«¯å¦‚ä½•äº¤äº’ï¼Ÿ  ====ã€‹API
- å‰åç«¯ç›¸å¯¹ç‹¬ç«‹ï¼Œæ¾è€¦åˆ
- å‰åç«¯ç”šè‡³å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼›



äº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼š

- 

è§£å†³æ–¹æ¡ˆï¼š

- é¦–å…ˆæŒ‡å®šschema[è®¡åˆ’çš„æçº²]ï¼Œå®æ—¶æ›´æ–°æœ€æ–°APIï¼Œé™ä½é›†æˆçš„é£é™©ï¼›
- æ—©äº›å¹´ï¼šæŒ‡å®šwordè®¡åˆ’æ–‡æ¡£ï¼›
- å‰åç«¯åˆ†ç¦»ï¼š
  - å‰ç«¯æµ‹è¯•åç«¯æ¥å£ï¼špostman
  - åç«¯æä¾›æ¥å£ï¼Œéœ€è¦å®æ—¶æ›´æ–°æœ€æ–°çš„æ¶ˆæ¯åŠæ”¹åŠ¨





Swagger

- å·ç§°ä¸–ç•Œä¸Šæœ€æµè¡Œçš„APIæ¡†æ¶ï¼›
- RESTFul APIæ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆå·¥å…· ==> **APIæ–‡æ¡£ä¸APIå®šä¹‰åŒæ­¥æ›´æ–°**
- ç›´æ¥è¿è¡Œï¼Œå¯ä»¥åœ¨çº¿æµ‹è¯•APIæ¥å£
- æ”¯æŒå¤šç§è¯­è¨€ï¼šï¼ˆJavaï¼ŒPHPã€‚ã€‚ã€‚ï¼‰

https://swagger.io/



### ä½¿ç”¨Swagger

ä¸¤ä¸ªç»„ä»¶ï¼š

- swagger2
- ui



### Springbooté›†æˆSwagger

1. æ–°å»ºä¸€ä¸ªspringboot webé¡¹ç›®

2. å¯¼å…¥ç›¸å…³ä¾èµ–

   ```xml
   <dependency>
               <groupId>io.springfox</groupId>
               <artifactId>springfox-swagger2</artifactId>
               <version>2.9.2</version>
           </dependency>
           <dependency>
               <groupId>io.springfox</groupId>
               <artifactId>springfox-swagger-ui</artifactId>
               <version>2.9.2</version>
           </dependency>
   ```

3. ç¼–å†™ä¸€ä¸ªhelloæ¥å£

4. é…ç½®Swagger  ==> Config

   ```java
   @Configuration
   @EnableSwagger2     // å¼€å¯Swagger2
   public class SwaggerConfig {
       
   }
   ```

5. æµ‹è¯•è¿è¡Œï¼šhttp://localhost:8080/swagger-ui.html

![](images/image-20211013162217811.png)



### é…ç½®Swagger

Swaggerçš„beançš„å®ä¾‹ `Docket`

```java
// é…ç½®Swaggerçš„Docketçš„beanå®ä¾‹
@Bean
public Docket docket() {
  return new Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo());
}

// é…ç½®Swaggerçš„ä¿¡æ¯
public ApiInfo apiInfo() {
  // ä½œè€…ä¿¡æ¯
  Contact contact = new Contact("AndyRon", "http://andyron.com", "rongming.2008@163.com");

  return new ApiInfo("AndyRonçš„Swagger APIæ–‡æ¡£",
                     "è¿™æ˜¯ä¸€ä¸ªæè¿°ä»‹ç»",
                     "v1.0",
                     "http://andyron.com",
                     contact,
                     "Apache 2.0",
                     "http://www.apache.org/licenses/LICENSE-2.0",
                     new ArrayList());
}
```



> spingbootæœ‰ä¸€ä¸ªè‡ªå¸¦/erroræ¥å£

### Swaggeré…ç½®æ‰«ææ¥å£

```java
@Bean
public Docket docket() {
  return new Docket(DocumentationType.SWAGGER_2)
    .apiInfo(apiInfo())
    .select()
    // RequestHandlerSelectors é…ç½®è¦æ‰«ææ¥å£çš„æ–¹å¼
    // basePackage()ï¼šæŒ‡å®šè¦æ‰«æçš„åŒ…
    // any()ï¼šæ‰«æå…¨éƒ¨
    // none()ï¼šä¸æ‰«æ
    // withMethodAnnotation(GetMapping.class)ï¼šæ‰«ææœ‰æ³¨è§£GetMappingçš„æ–¹æ³•
    // withClassAnnotation(RestController.class)ï¼šæ‰«ææœ‰æ³¨è§£RestControllerçš„ç±»
    .apis(RequestHandlerSelectors.basePackage("com.andyron.swagger.controller"))
    //                .apis(RequestHandlerSelectors.withMethodAnnotation(GetMapping.class))
    //paths() è¿‡æ»¤è·¯å¾„
    .paths(PathSelectors.ant("/andy/**"))
    .build();
}
```

> æˆ‘åªå¸Œæœ›swaggeråœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œåœ¨å‘å¸ƒçš„æ—¶å€™ä¸é€‚ç”¨ï¼Ÿ
>
> - åˆ¤æ–­æ˜¯ä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ
> - æ³¨å…¥enable
>
> ```java
>  // è®¾ç½®è¦æ˜¾ç¤ºçš„Swaggerç¯å¢ƒ
> Profiles profiles = Profiles.of("dev", "test");
> // åˆ¤æ–­æ˜¯å¦å¤„äºè‡ªå·±è®¾ç½®çš„ç¯å¢ƒä¸­
> boolean flag = environment.acceptsProfiles(profiles);
> ```
>
> 



é…ç½®APIæ–‡æ¡£çš„åˆ†ç»„

```java
.groupName("ä¸€ä¸ªç»„å")
```

å¦‚æœé…ç½®å¤šä¸ªåˆ†ç»„ï¼Œå¤šä¸ªDocketå®ä¾‹å³å¯ï¼š

```java
@Bean
public Docket docket1() {
  return new Docket(DocumentationType.SWAGGER_2).groupName("A");
}

@Bean
public Docket docket2() {
  return new Docket(DocumentationType.SWAGGER_2).groupName("B");
}

@Bean
public Docket docket3() {
  return new Docket(DocumentationType.SWAGGER_2).groupName("C");
}
```



å®ä½“ç±»é…ç½®ï¼š

```java
@ApiModel("ç”¨æˆ·å®ä½“ç±»")
public class User {

    @ApiModelProperty("ç”¨æˆ·å")
    private String username;
    @ApiModelProperty("å¯†ç ")
    private String password;

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}
```

```java
@ApiOperation("Hello2æ¥å£æ–¹æ³•æ³¨é‡Š")
@GetMapping("/hello2")
public String hello2(@ApiParam("ç”¨æˆ·å") String username) {
  return "Hello, Swagger!" + username;
}
```

æ€»ç»“ï¼š

1. æˆ‘ä»¬å¯ä»¥é€šè¿‡Swaggerç»™ä¸€äº›æ¯”è¾ƒéš¾ç†è§£çš„å±æ€§æˆ–æ¥å£ï¼Œå¢åŠ æ³¨é‡Šä¿¡æ¯
2. æ¥å£æ–‡æ¡£å®æ—¶æ›´æ–°
3. å¯ä»¥åœ¨çº¿æµ‹è¯•

ã€æ³¨æ„ç‚¹ã€‘åœ¨æ­£å¼å‘å¸ƒçš„æ—¶å€™ï¼Œå…³é—­Swaggerï¼ï¼ï¼







## ä»»åŠ¡

å¼‚æ­¥ä»»åŠ¡

å®šæ—¶ä»»åŠ¡

é‚®ä»¶å‘é€ 

### å¼‚æ­¥ä»»åŠ¡

```java
// å¼€å¯å¼‚æ­¥æ³¨è§£åŠŸèƒ½
@EnableAsync



// å‘Šè¯‰springï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•
@Async
```



### é‚®ä»¶å‘é€

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-mail</artifactId>
</dependency>
```

```java
MailSenderAutoConfiguration
MailSenderJndiConfiguration
JavaMailSenderImpl
```

 

### å®šæ—¶ä»»åŠ¡

```java
TaskScheduler    ä»»åŠ¡è°ƒåº¦è€…
TaskExecutor		ä»»åŠ¡æ‰§è¡Œè€…

  
@EnableScheduling  // å¼€å¯å®šæ—¶åŠŸèƒ½çš„æ³¨è§£
@Scheduled 	// ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ
  
Cronè¡¨è¾¾å¼
```

```
ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨å‡ 


0 0 10,14,16 * * ? æ¯å¤©ä¸Šåˆ10ç‚¹ï¼Œä¸‹åˆ2ç‚¹ï¼Œ4ç‚¹
0 0/30 9-17 * * ? æœä¹æ™šäº”å·¥ä½œæ—¶é—´å†…æ¯åŠå°æ—¶
0 0 12 ? * WED è¡¨ç¤ºæ¯ä¸ªæ˜ŸæœŸä¸‰ä¸­åˆ12ç‚¹
"0 0 12 * * ?" æ¯å¤©ä¸­åˆ12ç‚¹è§¦å‘
"0 15 10 ? * *" æ¯å¤©ä¸Šåˆ10:15è§¦å‘
"0 15 10 * * ?" æ¯å¤©ä¸Šåˆ10:15è§¦å‘
"0 15 10 * * ? *" æ¯å¤©ä¸Šåˆ10:15è§¦å‘
"0 15 10 * * ? 2005" 2005å¹´çš„æ¯å¤©ä¸Šåˆ10:15è§¦å‘
"0 * 14 * * ?" åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:59æœŸé—´çš„æ¯1åˆ†é’Ÿè§¦å‘
"0 0/5 14 * * ?" åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘
"0 0/5 14,18 * * ?" åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°2:55æœŸé—´å’Œä¸‹åˆ6ç‚¹åˆ°6:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘
"0 0-5 14 * * ?" åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:05æœŸé—´çš„æ¯1åˆ†é’Ÿè§¦å‘
"0 10,44 14 ? 3 WED" æ¯å¹´ä¸‰æœˆçš„æ˜ŸæœŸä¸‰çš„ä¸‹åˆ2:10å’Œ2:44è§¦å‘
"0 15 10 ? * MON-FRI" å‘¨ä¸€è‡³å‘¨äº”çš„ä¸Šåˆ10:15è§¦å‘
"0 15 10 15 * ?" æ¯æœˆ15æ—¥ä¸Šåˆ10:15è§¦å‘
"0 15 10 L * ?" æ¯æœˆæœ€åä¸€æ—¥çš„ä¸Šåˆ10:15è§¦å‘
"0 15 10 ? * 6L" æ¯æœˆçš„æœ€åä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘
"0 15 10 ? * 6L 2002-2005" 2002å¹´è‡³2005å¹´çš„æ¯æœˆçš„æœ€åä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘
"0 15 10 ? * 6#3" æ¯æœˆçš„ç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘
```





## é›†æˆRedis

P54-55  æ¥æºäºç‹‚ç¥è¯´redis

## åˆ†å¸ƒå¼Dubbo+Zookeeper

### åˆ†å¸ƒå¼ç†è®º

> **ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ**
> åœ¨ã€Šåˆ†å¸ƒå¼ç³»ç»ŸåŸç†ä¸èŒƒå‹ã€‹ä¸€ä¹¦ä¸­æœ‰å¦‚ä¸‹å®šä¹‰ï¼š<font color=#FF8C00>**â€œåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯è‹¥å¹²ç‹¬ç«‹è®¡ç®—æœºçš„é›†åˆï¼Œè¿™äº›è®¡ç®—æœºå¯¹äºç”¨æˆ·æ¥è¯´å°±åƒå•ä¸ªç›¸å…³ç³»ç»Ÿâ€**</font>ã€‚

åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆdistributed systemï¼‰æ˜¯ç”±ä¸€ç»„é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€ä¸ºäº†å®Œæˆ**å…±åŒçš„ä»»åŠ¡**è€Œåè°ƒå·¥ä½œçš„è®¡ç®—æœºèŠ‚ç‚¹ç»„æˆçš„ç³»ç»Ÿã€‚åˆ†å¸ƒå¼ç³»ç»Ÿçš„å‡ºç°æ˜¯ä¸ºäº†ç”¨å»‰ä»·çš„ã€æ™®é€šçš„æœºå™¨å®Œæˆå•ä¸ªè®¡ç®—æœºæ— æ³•å®Œæˆçš„è®¡ç®—ã€å­˜å‚¨ä»»åŠ¡ã€‚å…¶ç›®çš„æ˜¯**åˆ©ç”¨æ›´å¤šçš„æœºå™¨ï¼Œå¤„ç†æ›´å¤šçš„æ•°æ®ã€‚**

é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œ<u>åªæœ‰å½“å•ä¸ªèŠ‚ç‚¹çš„å¤„ç†èƒ½åŠ›æ— æ³•æ»¡è¶³æ—¥ç›Šå¢é•¿çš„è®¡ç®—ã€å­˜å‚¨ä»»åŠ¡çš„æ—¶å€™ï¼Œä¸”ç¡¬ä»¶çš„æå‡ï¼ˆåŠ å†…å­˜ã€åŠ ç£ç›˜ã€ä½¿ç”¨æ›´å¥½çš„CPUï¼‰é«˜æ˜‚åˆ°å¾—ä¸å¿å¤±çš„æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¸èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰éœ€è¦è€ƒè™‘åˆ†å¸ƒå¼ç³»ç»Ÿã€‚</u>å› ä¸ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè¦è§£å†³çš„é—®é¢˜æœ¬èº«å°±æ˜¯å’Œå•æœºç³»ç»Ÿä¸€æ ·çš„ï¼Œè€Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šèŠ‚ç‚¹ã€é€šè¿‡ç½‘ç»œé€šä¿¡çš„æ‹“æ‰‘ç»“æ„ï¼Œä¼šå¼•å…¥å¾ˆå¤šå•æœºç³»ç»Ÿæ²¡æœ‰çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜åˆä¼šå¼•å…¥æ›´å¤šçš„æœºåˆ¶ã€åè®®ï¼Œå¸¦æ¥æ›´å¤šçš„é—®é¢˜...

#### Dubboæ–‡æ¡£

https://dubbo.apache.org/zh/docs/

éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç«™åº”ç”¨çš„è§„æ¨¡ä¸æ–­æ‰©å¤§ï¼Œå¸¸è§„çš„å‚ç›´åº”ç”¨æ¶æ„å·²æ— æ³•åº”å¯¹ï¼Œåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ä»¥åŠæµåŠ¨è®¡ç®—æ¶æ„ï¼ˆå¦‚starkï¼‰åŠ¿åœ¨å¿…è¡Œï¼Œæ€¥éœ€ä¸€ä¸ªæ²»ç†ç³»ç»Ÿç¡®ä¿æ¶æ„æœ‰æ¡ä¸ç´Šçš„æ¼”è¿›ã€‚

![](images/image-20210930074842966-1590896.png)

##### å•ä¸€åº”ç”¨æ¶æ„

å½“ç½‘ç«™æµé‡å¾ˆå°æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚æ­¤æ—¶ï¼Œç”¨äº**ç®€åŒ–å¢åˆ æ”¹æŸ¥å·¥ä½œé‡çš„æ•°æ®è®¿é—®æ¡†æ¶ï¼ˆORMï¼‰**æ˜¯å…³é”®ã€‚
![](images/image-20211006083419311.png)
é€‚ç”¨äºå°å‹ç½‘ç«™ï¼Œå°å‹ç®¡ç†ç³»ç»Ÿï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åˆ°ä¸€ä¸ªåŠŸèƒ½é‡Œï¼Œç®€å•æ˜“ç”¨ã€‚ç¼ºç‚¹ï¼š
1ã€æ€§èƒ½æ‰©å±•æ¯”è¾ƒéš¾
2ã€ååŒå¼€å‘é—®é¢˜
3ã€ä¸åˆ©äºå‡çº§ç»´æŠ¤

##### å‚ç›´åº”ç”¨æ¶æ„

å½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨å¢åŠ æœºå™¨å¸¦æ¥çš„åŠ é€Ÿåº¦è¶Šæ¥è¶Šå°ï¼Œå°†åº”ç”¨æ‹†æˆäº’ä¸ç›¸å¹²çš„è€Œå‡ ä¸ªåº”ç”¨ï¼Œä¸€æäº¤æ•ˆç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºåŠ é€Ÿå‰ç«¯é¡µé¢å¼€å‘çš„Webæ¡†æ¶ï¼ˆMVCï¼‰æ˜¯å…³é”®ã€‚

![](images/image-20211006082511792.png)

é€šè¿‡åˆ‡åˆ†ä¸šåŠ¡æ¥å®ç°å„ä¸ªæ¨¡å—ç‹¬ç«‹éƒ¨ç½²ï¼Œé™ä½äº†ç»´æŠ¤å’Œéƒ¨ç½²çš„éš¾åº¦ï¼Œå›¢é˜Ÿå„å¸å…¶èŒæ›´æ˜“ç®¡ç†ï¼Œæ€§èƒ½æ‰©å±•ä¹Ÿæ›´æ–¹ä¾¿ï¼Œæ›´æœ‰é’ˆå¯¹æ€§ã€‚

> ç¼ºç‚¹ï¼šå…¬ç”¨æ¨¡å—æ— æ³•é‡å¤åˆ©ç”¨ï¼Œå¼€å‘æ€§çš„æµªè´¹ã€‚

##### åˆ†å¸ƒå¼æœåŠ¡æ¶æ„

å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„**åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼ˆRPCï¼‰**æ˜¯å…³é”®ã€‚

![](images/image-20211006083518506.png)

##### æµåŠ¨è®¡ç®—æ¶æ„

å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äº**æé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒï¼ˆSOAï¼‰[Service Oriented Architecture]æ˜¯å…³é”®**ã€‚

![](images/image-20211006083300639.png)

#### RPCåè®®

RPC ã€Remote Procedure Callã€‘æ˜¯æŒ‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œä»–æ˜¯ä¸€ç§**æŠ€æœ¯çš„æ€æƒ³**ï¼Œè€Œä¸æ˜¯**è§„èŒƒ**ã€‚å®ƒå…è®¸ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´ï¼ˆé€šå¸¸æ˜¯å…±äº«ç½‘ç»œçš„å¦ä¸€å°æœºå™¨ä¸Šï¼‰çš„è¿‡ç¨‹æˆ–å‡½æ•°ï¼Œè€Œä¸ç”¨ç¨‹åºå‘˜æ˜¾å¼ç¼–ç è¿™ä¸ªè¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚ã€‚å³ç¨‹åºå‘˜æ— è®ºæ˜¯è°ƒç”¨æœ¬åœ°çš„è¿˜æ˜¯è¿œç¨‹çš„å‡½æ•°ï¼Œ**æœ¬è´¨ä¸Šç¼–å†™çš„è°ƒç”¨ä»£ç åŸºæœ¬ç›¸åŒ**ã€‚
ä¹Ÿå°±æ˜¯è¯´ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°/æ–¹æ³•ï¼Œç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦**é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®**ã€‚

ä¸ºä»€ä¹ˆè¦ç”¨RPCå‘¢ï¼Ÿå°±æ˜¯æ— æ³•åœ¨ä¸€ä¸ªè¿›ç¨‹å†…ï¼Œç”šè‡³ä¸€ä¸ªè®¡ç®—æœºå†…é€šè¿‡æœ¬åœ°è°ƒç”¨çš„æ–¹å¼å®Œæˆçš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¸åŒçš„ç³»ç»Ÿé—´çš„é€šè®¯ï¼Œç”šè‡³ä¸åŒçš„ç»„ç»‡é—´çš„é€šè®¯ï¼Œç”±äºè®¡ç®—èƒ½åŠ›éœ€è¦æ¨ªå‘æ‰©å±•ï¼Œéœ€è¦åœ¨å¤šå°æœºå™¨ç»„æˆçš„é›†ç¾¤ä¸Šéƒ¨ç½²åº”ç”¨ã€‚RPCå°±æ˜¯è¦åƒè°ƒç”¨æœ¬åœ°çš„å‡½æ•°ä¸€æ ·å»è°ƒè¿œç¨‹å‡½æ•°ã€‚

æ¨èé˜…è¯»æ–‡ç« :https://wwwjianshu.com/p/2accc2840a1b

#####  RPCåŸºæœ¬åŸç†

![](images/image-20211006091435870.png)

æ­¥éª¤è§£æï¼š

![](images/image-20211006091614691.png)

RPCä¸¤ä¸ªæ ¸å¿ƒï¼š**é€šè®¯ï¼Œåºåˆ—åŒ–**ï¼ˆæ–¹ä¾¿æ•°æ®ä¼ è¾“ï¼‰ã€‚

Dubbo+Zookeeper  ä½¿ç”¨RPC

Spring Cloud ä½¿ç”¨ HTTP

dubboåº•å±‚ä½¿ç”¨nettyè¿›è¡Œç½‘ç»œé€šä¿¡ã€‚

dubboèµ·æºæ¯”è¾ƒæ—©ï¼Œä¸­é—´åœæ­¢ç»´æŠ¤5å¹´ï¼Œå¤§çº¦18å¹´å¼€å§‹é‡æ–°å¯åŠ¨ï¼Œè€Œåœ¨è¿™5å¹´é‡Œspring cloudè¯ç”Ÿå‘å±•ã€‚

Dubboä¸“æ³¨ä¸RPCï¼Œè€Œspringcloudæ˜¯ä¸ªç”Ÿæ€

### Dubbo

Apache Dubboæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æºJava RPCæ¡†æ¶ï¼Œä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼šé¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠæœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚

å®˜æ–¹ï¼šhttps://dubbo.apache.org/

é»˜è®¤ç«¯å£ï¼š20880

![](images/image-20211006100948707.png)



- æœåŠ¡æä¾›è€…ï¼ˆProviderï¼‰ï¼šæš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ï¼ŒæœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚
- æœåŠ¡æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ï¼šè°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ï¼ŒæœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºçŒ®è´Ÿæ¯‚å‡è¡¡äº¬æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœé˜–ç”¨å¤«è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚
- æ³¨å†Œä¸­å¿ƒï¼ˆRegistryï¼‰ï¼šæ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…
- ç›‘æ§ä¸­å¿ƒï¼ˆMonitorï¼‰ï¼šæœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒ

**è°ƒç”¨å…³ç³»è¯´æ˜**

- æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚
- æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚
- æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚
- æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚
- æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ 
- æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚

#### Dubboç¯å¢ƒæ­å»º

Zookeepræ³¨å†Œä¸­å¿ƒ

æ³¨å†Œä¸­å¿ƒæœ‰å¾ˆå¤šç§ï¼Œzookeeperæ˜¯å…¶ä¸­å®˜æ–¹æ¨èçš„ä¸€ç§ï¼Œå…¶å®ƒè¿˜æœ‰ï¼š

- Nacos æ³¨å†Œä¸­å¿ƒï¼ˆé˜¿é‡Œå·´å·´ï¼‰

- Multicast æ³¨å†Œä¸­å¿ƒ
- Redis æ³¨å†Œä¸­å¿ƒ

- Simple æ³¨å†Œä¸­å¿ƒ

zookeeper(åŠ¨ç‰©å›­ç®¡ç†åŠ¨ç‰©çš„)ï¼šhadoop  hive

> ZooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯Googleçš„Chubbyä¸€ä¸ªå¼€æºçš„å®ç°ï¼Œæ˜¯Hadoopå’ŒHbaseçš„é‡è¦ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚
>
> ZooKeeperçš„ç›®æ ‡å°±æ˜¯å°è£…å¥½å¤æ‚æ˜“å‡ºé”™çš„å…³é”®æœåŠ¡ï¼Œå°†ç®€å•æ˜“ç”¨çš„æ¥å£å’Œæ€§èƒ½é«˜æ•ˆã€åŠŸèƒ½ç¨³å®šçš„ç³»ç»Ÿæä¾›ç»™ç”¨æˆ·ã€‚



##### ä¸‹è½½å®‰è£…zookeeper

https://zookeeper.apache.org/

https://zookeeper.apache.org/releases.html

[apache-zookeeper-3.7.0.tar.gz](https://dlcdn.apache.org/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0.tar.gz)  æºç åŒ…mavené¡¹ç›®+bin

[apache-zookeeper-3.7.0-bin.tar.gz](https://dlcdn.apache.org/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz)  æ‰“å¥½çš„jar+bin

ä½¿ç”¨æºç åŒ…

- å¤åˆ¶`conf/zoo_sample.cfg`ä¸€ä»½ä¸º `conf/zoo.cfg`ä½œä¸ºé…ç½®æ–‡ä»¶
- `cd apache-zookeeper-3.7.0-bin/bin` 
- å¯åŠ¨zookeeperï¼š`sudo ./zkServer.sh start`

- æŸ¥çœ‹çŠ¶æ€ï¼š`./zkServer.sh start`  ã€‚å¯åŠ¨å¤±è´¥

```shell
$ ./zkServer.sh status
ZooKeeper JMX enabled by default
Using config: /Users/andyron/myfield/java/dubbo/apache-zookeeper-3.7.0/bin/../conf/zoo.cfg
Client port found: 2182. Client address: localhost. Client SSL: false.
Error contacting service. It is probably not running.
```

ä½¿ç”¨apache-zookeeper-3.7.0-bin.tar.gzé‡æ–°æ¥ä¸€éï¼Œçœ‹åˆ°**Mode: standalone**è¡¨ç¤ºå¯åŠ¨æˆåŠŸ

```shell
$ ./zkServer.sh status
ZooKeeper JMX enabled by default
Using config: /Users/andyron/myfield/java/dubbo/apache-zookeeper-3.7.0-bin/bin/../conf/zoo.cfg
Client port found: 2181. Client address: localhost. Client SSL: false.
Mode: standalone
```



- å¯åŠ¨å®¢æˆ·ç«¯`$ ./zkCli.sh`ï¼ˆä¹‹åçš„å®¢æœç«¯å°±ç”¨javaï¼‰ï¼Œä½¿ç”¨`ls /`åˆ—å‡ºzookeeperæ ¹ä¸‹ä¿å­˜çš„æ‰€æœ‰èŠ‚ç‚¹ï¼š

```shell
$ ./zkCli.sh
...

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
[zk: localhost:2181(CONNECTED) 0] ls /
[zookeeper]
[zk: localhost:2181(CONNECTED) 1]
```

`create -e /andyron 456`ï¼šåˆ›å»ºä¸€ä¸ªandyronèŠ‚ç‚¹ï¼Œå€¼ä¸º456ï¼›ä½¿ç”¨`get /andyron` è·å–èŠ‚ç‚¹å€¼ï¼š

```shell
[zk: localhost:2181(CONNECTED) 1] create -e /andyron 456
Created /andyron
Path must start with / character
[zk: localhost:2181(CONNECTED) 3] get /andyron
456
[zk: localhost:2181(CONNECTED) 4] ls /
[andyron, zookeeper]
```



> zoo.cfgé…ç½®æ–‡ä»¶ä¸­çš„å‡ ä¸ªå‚æ•°
> dataDir=/tmp/zookeeper   ä¸´æ—¶æ•°æ®å­˜å‚¨çš„ç›®å½•
> clientPort=2181		zookeeperçš„é»˜è®¤å¯¹clientçš„ç«¯å£å·



##### ä¸‹è½½å®‰è£…Dubbo

https://github.com/apache/dubbo

Zookeeperï¼šæ³¨å†Œä¸­å¿ƒï¼ˆæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼‰

dubbo-adminï¼šæ˜¯ä¸€ä¸ªç›‘æ§ç®¡ç†åå°ï¼ˆç½‘é¡µï¼‰ï¼ŒæŸ¥çœ‹æˆ‘ä»¬æ³¨å†Œäº†å“ªäº›æœåŠ¡ï¼Œå“ªäº›æœåŠ¡è¢«æ¶ˆè´¹äº†ï¼ˆä¸æ˜¯å¿…è¦çš„ï¼‰

dubboæœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªæœåŠ¡è½¯ä»¶ï¼Œå®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªjaråŒ…ï¼Œèƒ½å¤Ÿå¸®æˆ‘ä»¬çš„javaç¨‹åºè¿æ¥åˆ°zookeeperï¼Œå¹¶åˆ©ç”¨zookeeperæ¶ˆè´¹ã€æä¾›æœåŠ¡ã€‚

ä¸ºäº†è®©ç”¨æˆ·æ›´å¥½çš„ç®¡ç†ç›‘æ§ä¼—å¤šçš„dubboæœåŠ¡ï¼Œå®˜æ–¹æé«˜äº†ä¸€ä¸ªå¯è§†åŒ–çš„ç›‘æ§ç¨‹åºã€‚ 

-  ä¸‹è½½dubbo-adminï¼š

https://github.com/apache/dubbo-admin/tree/master

- åœ¨ `dubbo-admin-server/src/main/resources/application.properties`ä¸­æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€ï¼ˆå¦‚æœä¹‹å‰zookeeperçš„ç«¯å£æ²¡æœ‰æ”¹å˜ï¼Œè¿™é‡Œå°±ä¸éœ€è¦ä¿®æ”¹ï¼‰ï¼š

  ```properties
  admin.registry.address=zookeeper://127.0.0.1:2181
  admin.config-center=zookeeper://127.0.0.1:2181
  admin.metadata-report.address=zookeeper://127.0.0.1:2181
  ```

  

- æ„å»ºjaråŒ…ï¼Œåœ¨dubbo-adminé¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š

  ```shell
  sudo mvn clean package -Dmaven.test.skip=true 
  ```

  

- å¯åŠ¨dubbo

  ```shell
  cd dubbo-admin-distribution/target
  
  sudo java -jar dubbo-admin-0.3.0.jar
  ```

  > dubbo-admin å¯åŠ¨æ—¶å¯èƒ½å›æŠ¥`  Port 8080 was already in use`é”™è¯¯
  >
  > è¿™æ˜¯å› ä¸ºzookeeper 3.5.5ç‰ˆæœ¬ä¸­åŒ…å«ä¸€ä¸ªAdminServeré»˜è®¤çš„ç«¯å£æ˜¯8080ï¼Œæ‰€ä»¥å¯¼è‡´å ç”¨ã€‚
  >
  > å¯åœ¨zookeeperçš„é…ç½®æ–‡ä»¶zoo.cfgé…ç½®ï¼š
  >
  > ```
  > admin.serverPort=8081
  > ```
  >
  > æˆ–è€…dubbo-admin-serverçš„application.propertiesæ–‡ä»¶ä¸­æ·»åŠ ï¼š
  >
  > ```
  > server.port=2333
  > ```
  
  å¦å¤–ä¸€ç§å¯åŠ¨æ–¹å¼ï¼š
  
  ```
  sudo mvn --projects dubbo-admin-server spring-boot:run
  ```
  
  

- è®¿é—®http://localhost:8080/ï¼Œé»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯root



### å®æˆ˜

æ­¥éª¤ï¼š

1. idea ç©ºé¡¹ç›®

2. å»ºç«‹ä¸¤ä¸ªmoduleï¼Œprovider-serverï¼Œconsumer-serveråˆ†åˆ«ä½œä¸ºæœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…
3. ä¸¤ä¸ªå¼•å…¥ç›¸åŒçš„ä¾èµ–

```xml
<dependency>
  <groupId>org.apache.dubbo</groupId>
  <artifactId>dubbo-spring-boot-starter</artifactId>
  <version>2.7.8</version>
</dependency>

<!-- zkclient-->
<dependency>
  <groupId>com.github.sgroschupf</groupId>
  <artifactId>zkclient</artifactId>
  <version>0.1</version>
</dependency>

<dependency>
  <groupId>org.apache.curator</groupId>
  <artifactId>curator-framework</artifactId>
  <version>2.12.0</version>
</dependency>
<dependency>
  <groupId>org.apache.curator</groupId>
  <artifactId>curator-recipes</artifactId>
  <version>2.12.0</version>
</dependency>
<dependency>
  <groupId>org.apache.zookeeper</groupId>
  <artifactId>zookeeper</artifactId>
  <version>3.4.14</version>
  <!-- æ’é™¤slf4j-log4j12 é˜²æ­¢ä¸springå†²çª-->
  <exclusions>
    <exclusion>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-log4j12</artifactId>
    </exclusion>
  </exclusions>
</dependency>
```

4. åœ¨provider-serverä¸­

   ```properties
   server.port=8001
   
   # æœåŠ¡åº”ç”¨çš„åå­—
   dubbo.application.name=provider-server
   # æ³¨å†Œä¸­å¿ƒåœ°å€
   dubbo.registry.address=zookeeper://127.0.0.1:2181
   # å“ªäº›æœåŠ¡è¦è¢«æ³¨å†Œ
   dubbo.scan.base-packages=com.andyron.service
   ```

   ```java
   package com.andyron.service;
   
   import org.apache.dubbo.config.annotation.Service;
   import org.springframework.stereotype.Component;
   
   
   // zookeeperï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°
   
   @Service // å¯ä»¥è¢«æ‰«æåˆ°ï¼Œåœ¨é¡¹ç›®å·²å¯åŠ¨å°±è¢«æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ
   @Component  // ä½¿ç”¨äº†Dubboåå°½é‡ä¸è¦æ˜¯@Serviceæ³¨è§£
   public class TicketServiceImpl implements TicketService {
       @Override
       public String getTicket() {
           return "å­¦ä¹ dubbo+zookeeper";
       }
   }
   
   ```

5. å¼€å¯zookeeperå’Œ dubbo-admin

6. å¼€å¯provider-serverï¼Œæ­¤æ—¶å°±èƒ½åœ¨dubbo-adminä¸­è§‚å¯Ÿåˆ°æœåŠ¡æä¾›è€…

7. consumer-server

   ```properties
   server.port=8002
   
   # æ¶ˆè´¹è€…å–å“ªé‡Œæ‹¿æœåŠ¡ï¼Œéœ€è¦æš´éœ²è‡ªå·±çš„åå­—
   dubbo.application.name=consumer-server
   dubbo.registry.address=zookeeper://127.0.0.1:2181
   ```

   ```java
   package com.andyron.service;
   
   public interface TicketService {
   
       public String getTicket();
   }
   ```

   ```java
   package com.andyron.service;
   
   import org.apache.dubbo.config.annotation.DubboReference;
   import org.springframework.stereotype.Service;
   
   @Service  // æ”¾å…¥åˆ°å®¹å™¨ä¸­ï¼Œæ³¨æ„ä¸æ˜¯dubboçš„
   public class UserService {
   
       // æƒ³æ‹¿åˆ°provider-serveræä¾›çš„ç¥¨ï¼Œè¦å»æœåŠ¡ä¸­çº¿æ‹¿æœåŠ¡
       @DubboReference // è¿œç¨‹å¼•ç”¨ï¼Œå¯¹åº”æœ¬åœ°çš„@Autowiredã€‚1 POMåæ ‡ï¼Œ2å®šä¹‰ï¼ˆå’Œprovider-serverï¼‰è·¯å¾„ç›¸åŒçš„æ¥å£ï¼ˆTicketServiceï¼‰
       TicketService ticketService;
   
       public void buyTicket() {
           String ticket = ticketService.getTicket();
           System.out.println("åœ¨æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°===>" + ticket);
       }
   }
   ```

   åœ¨consumer-serverä¸­æµ‹è¯•å°±èƒ½è·å¾—æ³¨å†Œä¸­å¿ƒæœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡ã€‚



æ€»ç»“æ­¥éª¤ï¼š

å‰ææ˜¯å¼€å¯zookeeper

1. æä¾›è€…æä¾›æœåŠ¡
   1. å¯¼å…¥ä¾èµ–
   2. é…ç½®æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼Œä»¥åŠæœåŠ¡å‘ç°åï¼Œå’Œè¦æ‰«æçš„åŒ…
   3. åœ¨æƒ³è¦è¢«æ³¨å†Œçš„æœåŠ¡ä¸Šé¢å¢åŠ ä¸€ä¸ªæ³¨è§£`@Service`ï¼ˆDubboçš„ï¼‰
2. æ¶ˆè´¹è€…å¦‚ä½•æ¶ˆè´¹
   1. å¯¼å…¥ä¾èµ–
   2. é…ç½®æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼Œé…ç½®è‡ªå·±çš„æœåŠ¡å
   3. ä»è¿œç¨‹æ³¨å…¥æœåŠ¡ `@DubboReference`



### ç°åœ¨å’Œæœªæ¥

p61











